<!DOCTYPE html>
<html lang="de">
  <head>
    <link rel="apple-touch-icon" href="icon.png">
    <title>CoffeeLog</title>
    <meta charset="utf-8">
    <meta name="apple-mobile-web-app-title" content="CoffeeLogger">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#D1B888">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <style>
* {
    box-sizing: border-box;
    font-family: system-ui, iconMode;
    -webkit-tap-highlight-color: transparent;
/*-webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);*/
}

body {
  margin:0;
  background-color: #D1B888;
/*  background: linear-gradient(0deg, rgba(222,179,103,.8) 0%, rgba(209,184,136,1) 90%);*/
  touch-action: none;
  background-attachment: fixed;
  height: 100vh;
  width: 100vw;
  overflow: hidden;
}



#appTitle {
  margin-left: 4vw;
  margin-top: 0vw;
  font-size: 10vw;
  display: block;
  touch-action: none;
}

.grinders {
  font-weight: light;
  font-size: 5vw;
  text-align: right;
  left: 5vw;
}

#headerButtonContainer {
  display: flex;
  position: fixed;
  top: 4.2vw;
  right: 0vw;
}

#exportButton {
  display: none;
  z-index: 0;
  height: 13vw;
  max-width: 20vw;
  min-width: 13vw;
  padding: 0;
  font-size: 3vw; /* 7vw */
  top: 0vw;
  box-shadow: 0px 0px 10px -2px #00000020;
}

#menuButton {
  z-index: 0;
  padding: 0vw;
  /*position: fixed;
  right: 0.5vw;*/
  font-size: 3vw;
  height: 13vw;
  max-width:18vw;
  min-width: 13vw;
  box-shadow: 0px 0px 10px -2px #00000020;
}

::-webkit-scrollbar {
  display: none; /* Safari and Chrome */
}

#roundedCorners1, #roundedCorners2 {
  border: none;
  border-radius: 15px;
  overflow: scroll;
  overflow-x: hidden;
  width: 96%;
  max-height: 69.5vw;
  margin-right: 2%;
  margin-left: 2%;
  margin-bottom: 3vw;
  box-shadow: 0px 0px 12px -2px #00000020;
  overscroll-behavior: none;
}

#roundedCorners1 {
  max-height: 85vw;
  position: fixed;
  top: 19.1vw;
}

#roundedCorners2 {
  position: fixed;
  max-height: 75vw;
  top: 114.1vw;
}

 #grinder1Title {
  position: fixed;
  top: 12vw;
 }
 #grinder2Title {
  position: fixed;
  top: 107vw;
 }

table {
  border-collapse: collapse;
  width: 100%;
  text-align: center;
  border: none;
}

thead {
  border: none;
}

thead tr {
  position: sticky;
  top: -0.2px;
  background-color: #E5D9BE;
  font-size: 3vw;
  border: none;
  height: 12.5vw;
  filter: drop-shadow(0px 1px 1px #00000020);
  z-index: 2;
}

tbody tr {
  transition: transform 0.3s ease-in-out;
  height: 12vw;
}

tbody {
/*  font-weight: light;*/
  font-size: 3.5vw;
}

td {
    border: none;
    min-width: 2vw;
}

tbody tr:nth-child(even) {
  background-color: #E2D0AD;
}
tbody tr:nth-child(odd) {
  background-color: #D7C29C;
}
tbody td:nth-child(-n+2) {
  font-size: 3vw;
}

.dark-theme {
  background-color: #353935;
  background: linear-gradient(0deg, #151515 0%, #151515 100%);
/*   background: linear-gradient(0deg, #192124 0%, #2b2e30 100%)282C34
;*/
  color: #ffffff99;/*#b5b4b2ee;*/
}

.dark-theme tbody tr:nth-child(even) {
    background-color: #282828;
}
.dark-theme tbody tr:nth-child(odd) {
  background-color: #1c1c1c;
}
.dark-theme thead tr {
    background-color: #2C2C2E;
}

.dark-theme thead tr td{
    color: #ffffff90;
}

.dark-theme button,
.dark-theme #resetButton {
  background-color: #00000030;
  color: #000000;
}

.dark-theme #addBrew, .dark-theme #menuButton, .dark-theme #exportButton {
  background-color: #ffffff30;
}

.dark-theme #addBrew {
  box-shadow: 0px 0px 60px 30px #00000025;
}

.dark-theme #roundedCorners1, .dark-theme #roundedCorners2 {
  box-shadow: 0px 0px 12px -2px #00000020;
}

.dark-theme #logDetails,
.dark-theme #idTime,
.dark-theme #formInput1,
.dark-theme #formInput2,
.dark-theme #formInput3,
.dark-theme #selectList,
.dark-theme #editingInput,
.dark-theme input {
  background-color: #00000040;
  color: #A9A9A987;
}

.dark-theme #selectList {
  color: #ffffff47;
}
.dark-theme .form-container, .dark-theme #popup, .dark-theme #editingContainer {
   background-color: #ffffff15; /*#d2b48c30;*/
   -webkit-backdrop-filter: blur(20px);
   backdrop-filter: blur(20px);
}
.dark-theme .form-popup, .dark-theme #popupBackground {
  background-color: #ffffff00;
}
.dark-theme #logDetails:focus,
.dark-theme #idTime:focus,
.dark-theme #selectList:focus,
.dark-theme #formInput1:focus,
.dark-theme #formInput2:focus,
.dark-theme #formInput3:focus {
  -webkit-backdrop-filter: blur(35px);
  backdrop-filter: blur(35px);
  background-color: #00000075;
  outline: none;
}
.dark-theme #title {
  font-weight: bold;
  color: #000000;
}

.dark-theme .form-container button, .dark-theme #resetButton {
  color: #ffffff67;
  background-color: #00000040;
}

.dark-theme #grinder1Title, .dark-theme #grinder2Title, .dark-theme #appTitle {
  color: #ebebeb87;
}

.dark-theme #inputIcon {
  color: #000000;
}

.dark-theme .cursor {
  background-color: #ffffff67;
}

.dark-theme #rating-container {
  background-color: #ffffff08; /*#d2b48c30;*/
  -webkit-backdrop-filter: blur(45px);
  backdrop-filter: blur(45px);
  box-shadow: 0px 0px 20px 0px #00000090;
}

/*.dark-theme #ratingCancelButton {
   background-color: #ffffff10;
   -webkit-backdrop-filter: blur(20px);
   color: black;
}*/

.dark-theme #rating-item {
  color: #000000;
  background-color: #ffffff20;
}
.dark-theme ::placeholder {
  color: #ffffff87;
}

.dark-theme #editingContainer {
    box-shadow: 0px 0px 45px 30px #00000025;
    background-color: #ffffff15;
}
.dark-theme #editingContainer button {
  color: #ffffff67;
}

button {
  font-size: 5.5vw;
  padding:1.5vw;
  min-width: 18vw;
  color: black;
  border: none;
  border-radius: 10px;
  text-align: center;
  margin-right: 2vw;
  background-color: #ffffff50;
  -webkit-backdrop-filter: blur(55px);
  backdrop-filter: blur(55px);
}

#resetButton {
  margin-left: auto;
  height: 13vw;
  min-width: 20vw;
  padding: 0;
  text-align: center;
  font-size: 5.5vw;
  color: black;
  background-color: #ffffff50;
  -webkit-backdrop-filter: blur(55px);
  backdrop-filter: blur(55px);
  border: none;
  border-radius: 10px;
}

#saveButtonAdd {
  margin-left: 3vw;
  margin-right: 0vw;
  height: 13vw;
  min-width: 20vw;
}

#addBrew {
  position: fixed;
  z-index: 1;
  background-color: #ffffff30;
  max-width:18vw;
  min-width: 15vw;
  min-height: 13vw;
  bottom: 10vh;
  right: 3vw;
  padding: 0;
  box-shadow: 0px 0px 30px 10px #09090925;
}

input, select {
  padding-left: 4vw;
  min-width: 18vw;
}

::placeholder {
  color: #00000090; 
  font-size: 5vw;
  opacity: 0.55;
}

.form-popup, #popupBackground {
  display: none;
  position: fixed;
  z-index: 1;
  top: 0px;
  left: 0px;
  padding: 0;
  border: none;
  background-color: #ffffff00;
  width: 100vw;
  height:100vh;
}

/* Add styles to the form container */
.form-container, #popup, #editingContainer {
 width: 89.6vw;
 left: 5vw;
 top: 25vw;
 position: fixed;
 background-color: #00000025;
 -webkit-backdrop-filter: blur(45px);
 backdrop-filter: blur(45px);
 border-radius: 20px;
 padding: 4vw;
 /*transition: opacity 0.3s forwards;*/
}

#title {
  font-size: 10vw;
  font-weight: bold;
  margin-left: 1vw;
}
/* input fields()*/ 
#logDetails,
#idTime,
#selectList,
#formInput1,
#formInput2,
#formInput3,
#editingInput {
  width: 100%;
  height: 14vw;
  border: none;
  border-radius: 10px;
  background-color: #ffffff50;
  font-size: 5vw;
  color: black;
  margin-left: auto;
  outline: none;
}

#selectList {
  appearance: none;
}
/* When the inputs get focus, do something */
#logDetails:focus,
#idTime:focus,
#selectList:focus {
  -webkit-backdrop-filter: blur(35px);
  backdrop-filter: blur(35px);
  background-color: #ffffff85;
  outline: none;
}

#menu-form button {
  padding: 5pt;
  width: 30.7%;
  margin: 0;
  height: 14vw;
}

#menu-form input {
  width: 100%;
  margin-bottom: 3.2%;
  text-align: left;
  padding-left: 4vw;
}

#menu-form input:focus {
  background-color: #ffffffaa;
}

#inputIcon {
  font-size: 8vw;
  display: none;
  justify-content: center;
  align-items: center;
}

#firstRow, #secondRow, #thirdRow {
      vertical-align: middle;
      justify-content: space-evenly;
      display: flex;
      padding:0;
      margin-bottom: 3vw;
}
#buttonRow, #headRow {
  justify-content: space-between;
  display: flex;
}
#headRow {
  height: 15vw;
  margin-left: 0vw;
}

#popBtnContainer {
  display: flex;
  justify-content: space-between;
  width: 100%;
}

#popInpContainer {
  justify-content: space-evenly;
  margin-left: auto;
  margin-right: auto;
}

#rating-popup {
  -webkit-backdrop-filter: blur(0px);
  backdrop-filter: blur(0px);
  top:0;
  position: fixed;
  height: 100vh;
  width: 100vw;
  display: none;
}

#rating-container {
  position: fixed;
  display: none;
  top: 25vh;
  right: 22%;
  height: 93vw;
  background-color: #00000020;
  border-radius: 15px;
  -webkit-backdrop-filter: blur(45px);
  backdrop-filter: blur(45px);
  box-shadow: 0px 0px 50px -5px #00000035;
}

#rating-container ul {
  justify-content: space-evenly;
  align-items: center;
  padding: 0;
  margin-top: 0vw;
  margin-bottom: 0vw;
}

#rating-item {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 12vw;
  height: 12vw;
  margin: 3vw;
  border-radius:8px;
  -webkit-backdrop-filter: blur(25px);
  backdrop-filter: blur(25px);
  background-color: #ffffff60;
  color: black;
  font-family: system-ui;
  font-size: 9vw;
  font-weight: 500;
}

.dark-theme .markDelete, .dark-theme .editingMode {
  background-color: #ff000027 !important;
  border-radius: 5px;
  color: #ffffff87;
}

.markDelete, .editingMode {
  background-color: #A32D36dd !important;
  border-radius: 5px;
  color: #e8dbc4;
  /*transition: background-color 1.9s ease;*/
  transition: color 0.5s ease;
}

/*.parent-class {
  position: relative;
  z-index: 9999;
}*/

#editingBG {
  background-color: #00000000;
  top:0;
  position: fixed;
  width: 100vw;
  height: 100vh;
  display: none;
/*  -webkit-backdrop-filter: blur(0px);
  backdrop-filter: blur(0px);*/
/*  z-index: 0;*/
}

#editingContainer {
  display: block;
  width: 54vw;
  padding: 2.5vw;
  position: fixed;
  top: 40vh;
  left: 22.5vw;
  background-color: #ffffff05;
/*  box-shadow: 0px 0px 45px 30px #00000025;*/
  box-shadow: 0px 0px 80px 30px #70707055;
  border-radius: 12px;
}

#editingContainer button {
  height: 12vw;
  border-radius: 8px;
  max-width: 16vw;
  margin: 0;
}

#editingContainer input {
  height: 12vw;
  border-radius: 8px;
  width: 28.5vw;
  padding-left: 5%;
  margin: 0;
/*  margin-right: 1vw;*/
}

#editingButtonContainer {
  display: flex;
  justify-content: space-between;
}

#delete, #delete2 {
  position: absolute;
  left: 92vw;
  width: 21vw;
  height: 10.5vw;
  top: 10.25vw;
  background-color: #A32D36; /*#AF2F3C; 8b0000;*/
  color: white;
  justify-content: left;
  align-items: center;
  padding-left: 6vw;
  display: none;
  box-shadow: 0px 0px 8px 0px inset #00000070;
  transition: transform 0.3s ease-in-out;
}

#details, #details2 {
  position: absolute;
  top: 10.25vw;
  left: -17vw;
  width: 21vw;
  height: 10.5vw;
  background-color: darkgrey;
  color: white;
  justify-content: right;
  align-items: center;
  padding-right: 6vw;
  display: none;
  box-shadow:0px 0px 8px 0px inset #00000040;
  transition: transform 0.3s ease-in-out;
}

.dark-theme #details, .dark-theme #details2 {
  background-color: #505050;
}

.dark-theme #deleteB, .dark-theme #deleteB2 {
  background-color: #8b0000;
}

#detailsBG {
  -webkit-backdrop-filter: blur(15px);
  backdrop-filter: blur(15px);
  position: fixed;
  z-index: 6;
  width: 100vh;
  height: 100vh;
  top: 0;
  display: none;
}

#detailsBG ::placeholder {
  color: #000000;
  opacity: 0.5;
}

.dark-theme #detailsBG ::placeholder {
  color: #ffffff;
  opacity: 0.3;
}

#titleExportContainer {
  display: flex;
  justify-content: space-between;
  margin-bottom: 3vw;
  align-items: center;
  height: 10vw;
}

#coffeeExport {
  background-color: #ffffff20;
  border-radius: 8px;
  height: 10vw;
  padding: 1.5vw;
  font-size: 5vw;
  display: flex;
  text-align: center;
  align-items: center;
  margin-bottom: 0;
}

#detailsBG h1 {
  margin-bottom: 2.5vw;
  padding: 0;
  font-size: 8vw;
}

#detailsBG input, #detailsBG select, #coffeeRating {
  height: 10vw;
  width: 100%;
  border-radius: 9px;
  background-color: #ffffff65;
  -webkit-backdrop-filter: blur(25px);
  backdrop-filter: blur(25px);
  outline: none;
  border: none;
  margin-bottom: 3vw;
  font-size: 5vw;
  padding-left: 4vw;
  color: black;
}

.dark-theme #detailsBG input, .dark-theme #detailsBG button, .dark-theme #detailsBG select, .dark-theme #coffeeRating {
  background-color: #00000040;
  color: #ffffff87;
}

.dark-theme #detailsContainer {
  background-color: #ffffff15;
}

.dark-theme #detailsBG input:focus {
  background-color: #00000060
}

#detailsBG input:focus {
  background-color: #ffffffaa;
}

#detailsBG button {
  height: 10vw;
  border-radius: 9px;
  font-size: 5.5vw;
  margin: 0;
  background-color: #ffffff55;
  -webkit-backdrop-filter: blur(25px);
  backdrop-filter: blur(25px);
  
}

#detailsBts {
  display: flex;
  justify-content: space-between;
/*  margin-top: 2vw;*/
}

#detailsContainer {
  background-color: #00000015;
  -webkit-backdrop-filter: blur(55px);
  backdrop-filter: blur(45px);
  padding: 4vw;
  position: fixed;
  border-radius: 20px;
  width: 90vw;
  left: 5vw;
  top: 2vh;
  display: none;
}

#removeCoffeeFromBrew, #deleteCoffee {
  opacity: 0.7;
}

#coffeeRating {
  display: flex;
  font-family: iconMode;
  align-items: center;
  font-size: 5vw;
  color: rgb(0, 0, 0, 0.6);
  background-color: #ffffff65;
  padding-left: 3vw;
/*  justify-content: center;*/
}

.dark-theme #coffeeRating {
  color: rgb(255, 255, 255, 0.5);
}

/*.dark-theme #detailsBG #removeCoffeeFromBrew, .dark-theme #detailsBG #deleteCoffee {
  color: #ffffff;
}*/

/* ================= keyboard*/
.cursor { 
  position: absolute;
  height: 80%;
  width: 2px;
  background-color: black;
  animation: blink 1s infinite;
  display: none;
  z-index: 2;
}

@keyframes blink {
  40% { opacity: 0; }
}

#keyboardContainer {
  background-color: #00000018;
  -webkit-backdrop-filter: blur(45px);
/*  backdrop-filter: blur(45px);*/
  position: fixed;
  bottom: 10vh;
  border-radius: 12px;
  padding: 3vw;
  max-height: 30vh;
  width: 96vw;
  left: 2vw;
}

.dark-theme #keyboardContainer {
  background-color: #ffffff15;
}

.dark-theme #keyboardContainer div div {
  background-color: #00000055;
  color: #ffffff67;
}
.dark-theme #keyboardContainer div div.pressed {
  background-color: #00000095;
}

 #keyboardContainer div div {
  background-color: #ffffff55;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 11vw;
  width: 16vw;
  border-radius: 7px;
  color: black;
  font-size: 6vw;
  box-shadow: 0px 0px 5px -2px #00000040;
}

 #keyboardContainer div div.pressed {
  background-color: #ffffff80;
  box-shadow: none;
}

/*#kbSpacebar {
  min-width: 35vw;
}

#kbDelete {
  width: 16vw;
}*/

#kbFirstRow, #kbSecondRow, #kbThirdRow {
  display: flex;
  justify-content: space-between;
}
#kbFirstRow, #kbSecondRow {
  margin-bottom: 3vw;
}

/* ======== ANIMATIONS ====== */
.spaceOutUp {
  animation: spaceOutUp 0.25s;
}
.spaceInUp {
  animation: spaceInUp 0.30s ease-in-out;
}

/*.pulseSize {
  animation: pulseSize 0.3s infinite;
}

.pulseShadow {
  animation: pulseShadow 0.3s infinite;
}

@keyframes pulseSize {
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(1.015);
  }

  100% {
    transform: scale(1);
  }
}

@keyframes pulseShadow {
  0% {
    box-shadow: 0 0 0 0 rgba(0, 0, 0, 0.4);
  }

  70% {
    box-shadow: 0 0 0 6px rgba(0, 0, 0, 0);
  }

  100% {
    box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);
  }
}*/

@keyframes spaceOutUp {
  0% {
    opacity: 1;
    -webkit-transform-origin: 50% 0%;
    transform-origin: 50% 0%;
    -webkit-transform: scale(1) translate(0%, 0%);
    transform: scale(1) translate(0%, 0%);
    -webkit-filter: blur(0);
    filter: blur(0);
  }

  100% {
    opacity: 0;
    -webkit-transform-origin: 50% 0%;
    transform-origin: 50% 0%;
    -webkit-transform: scale(0.2) translate(0%, -200%);
    transform: scale(0.2) translate(0%, -200%);
    -webkit-filter: blur(40px);
    filter: blur(40px);
  }
}

@keyframes spaceInUp {
  0% {
    opacity: 0;
    -webkit-transform-origin: 50% 0%;
    transform-origin: 50% 0%;
    -webkit-transform: scale(0.2) translate(0%, -200%);
    transform: scale(0.2) translate(0%, -200%);
    -webkit-filter: blur(40px);
    filter: blur(40px);
  }

  100% {
    opacity: 1;
    -webkit-transform-origin: 50% 0%;
    transform-origin: 50% 0%;
    -webkit-transform: scale(1) translate(0%, 0%);
    transform: scale(1) translate(0%, 0%);
    -webkit-filter: blur(0);
    filter: blur(0);
  }
}


/* ====== OLD ==== */
.visible {
  opacity: 1;
}
.fade-in {
  animation: fade-in 0.5s forwards;
}
.fade-out {
  animation: fade-out 0.41s forwards;
}

.blur-in {
  animation: blur-in 0.5s forwards;
}

.blur-out {
  animation: blur-out 0.41s ease;
}

.slide-in-blurred-top {
animation: slide-in-blurred-top 0.50s cubic-bezier(0.230, 1.000, 0.320, 1.000) both;
}

.slide-out-blurred-top {
animation: slide-out-blurred-top 0.40s cubic-bezier(0.230, 1.000, 0.320, 1.000) both;
}

.slide-in-blurred-right {
  animation: slide-in-blurred-right 0.35s cubic-bezier(0.230, 1.000, 0.320, 1.000) both;
}

/* cubic-bezier(0.755, 0.050, 0.855, 0.060) both */
.slide-out-blurred-right {
  animation: slide-out-blurred-right 0.25s cubic-bezier(0.4, 0.050, 0.4, 0.060) both;
}

.slide-in-blurred-bottom {
  animation: slide-in-blurred-bottom 0.75s cubic-bezier(0.230, 1.000, 0.320, 1.000) both;
}

.slide-out-blurred-bottom {
  animation: slide-out-blurred-bottom 0.35s cubic-bezier(0.230, 1.000, 0.320, 1.000) both;
}

.slide-in-edit {
  animation: slide-in-edit 0.30s;
}
.slide-out-edit {
  animation: slide-out-edit 0.30s ease-in-out;
}

@keyframes slide-in-blurred-top {
  0% {
      		transform: translateY(-150px) scaleY(0.9) scaleX(0.1);
      		transform-origin: 50% 0%;
      		-webkit-filter: blur(0px);
   	 		opacity: 0;
  }
  100% {
					transform: translateY(0) scaleY(1) scaleX(1);
        		transform-origin: 50% 50%;
        		-webkit-filter: blur(0);
  					opacity: 1;
  }
}

@keyframes slide-out-blurred-top {
  0% {
        transform: translateY(0) scaleY(1) scaleX(1);
        transform-origin: 50% 0%;
        -webkit-filter: blur(1px);
    			opacity: 0.8;
  }
  100% {
          transform: translateY(-100px) scaleY(0.9) scaleX(0.2);
          transform-origin: 50% 50%;
          -webkit-filter: blur(100px);
    				opacity: 0;
  }
}

@keyframes slide-in-blurred-right {
  0% {
    -webkit-transform: translateX(200px) scaleX(1) scaleY(0.2);
            transform: translateX(200px) scaleX(1) scaleY(0.2);
    -webkit-transform-origin: 0% 50%;
            transform-origin: 0% 50%;
    -webkit-filter: blur(0px);
            filter: blur(0px);
    opacity: 0.5;
  }
  100% {
    -webkit-transform: translateX(0) scaleY(1) scaleX(1);
            transform: translateX(0) scaleY(1) scaleX(1);
    -webkit-transform-origin: 50% 50%;
            transform-origin: 50% 50%;
    -webkit-filter: blur(0);
            filter: blur(0);
    opacity: 1;
  }
}

@keyframes slide-out-blurred-right {
  0% {
    -webkit-transform: translateX(0) scaleY(1) scaleX(1);
            transform: translateX(0) scaleY(1) scaleX(1);
    -webkit-transform-origin: 50% 50%;
            transform-origin: 50% 50%;
    -webkit-filter: blur(10px);
            filter: blur(10px);
    opacity: 1;
  }
  100% {
    -webkit-transform: translateX(200px) scaleX(1) scaleY(0.2);
            transform: translateX(200px) scaleX(1) scaleY(0.2);
    -webkit-transform-origin: 0% 50%;
            transform-origin: 0% 50%;
    -webkit-filter: blur(40px);
            filter: blur(40px);
    opacity: 0;
  }
}

@keyframes slide-in-edit {
  0% {
      		transform: translateY(-20px) scaleY(0.9) scaleX(0.1);
      		transform-origin: 50% 0%;
        -webkit-filter: blur(5px);
   	 		opacity: 0;
  }
  100% {
					transform: translateY(0) scaleY(1) scaleX(1);
        		transform-origin: 50% 50%;
          -webkit-filter: blur(0px);
  					opacity: 1;
  }
}

@keyframes slide-out-edit {
  0% {
        transform: translateY(0) scaleY(1) scaleX(1);
        transform-origin: 50% 0%;
        -webkit-filter: blur(1px);
    			opacity: 1;
  }
  100% {
          transform: translateY(-50px) scaleY(0.9) scaleX(0.1);
          transform-origin: 50% 50%;
          -webkit-filter: blur(40px);
    				opacity: 0;
  }
}

@keyframes slide-in-blurred-bottom {
  0% {
    transform: translateY(250px) scaleY(0.9) scaleX(0.2);
    transform-origin: 50% 100%;
    -webkit-filter: blur(0px);
    opacity: 0;
  }
  100% {
    transform: translateY(0) scaleY(1) scaleX(1);
    transform-origin: 50% 50%;
    -webkit-filter: blur(0);
    opacity: 1;
  }
}

@keyframes slide-out-blurred-bottom {
  0% {
    transform: translateY(0) scaleY(1) scaleX(1);
    transform-origin: 50% 50%;
    -webkit-filter: blur(1px);
    opacity: 1;
  }
  100% {
    transform: translateY(250px) scaleY(0.9) scaleX(0.2);
    transform-origin: 50% 100%;
    -webkit-filter: blur(35px);
    opacity: 0;
  }
}

@keyframes blur-out {
  0% {
    -webkit-backdrop-filter: blur(20px)
  }
  100% {
    -webkit-backdrop-filter: blur(0px)
  }
}
@keyframes blur-in {
  0% {
    -webkit-backdrop-filter: blur(0px)
  }
  100% {
    -webkit-backdrop-filter: blur(20px)
  }
}

@keyframes fade-out {
  0% {
    opacity: 1;
  }
  100% {
    opacity: 0;
  }
}
@keyframes fade-in {
  0% {
    opacity: 0;
  }
  100% {
		opacity: 1;
  }
}
 
   </style>
</head>
<body>
<h1 id="appTitle">Coffee Log</h1>
<div id="headerButtonContainer">
  <button id="exportButton" onclick="shareCSV()">Export</button>
  <button id="menuButton" onclick="showPopup()">Menu</button>
</div>
  
<div id="grinder1Title" class="grinders">Grinder 1</div>
<div id="roundedCorners1">
	<div id="delete">Delete</div> 
	<div id="details">Details</div> 
  <table id="grinder1">
    <thead id="tableHead1">
      <tr>
              <td>Date</td>
              <td>Time</td> 
              <td>Set.</td>
              <td>gr.</td> 
              <td>ml.</td>
              <td>&deg;C</td> 
              <td>Recipe</td>
              <td>Rating</td> 
              <td>Draw</td>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>
</div>

<!-- <button id="toggleB1" onclick="toggleTable1();toggleSlice1()">&#x100068;</button> -->
<button id="addBrew" onclick="openForm()">Add</button>

<div class="grinders" id="grinder2Title">Grinder 2</div>
<div id="roundedCorners2">
  	<div id="delete2">Delete</div> 
	<div id="details2">Details</div> 
  <table id="grinder2">
    <thead id="tableHead2">
      <tr>
               <td>Date</td>
              <td>Time</td> 
              <td>Set.</td>
              <td>gr.</td> 
              <td>ml.</td>
              <td>&deg;C</td> 
              <td>Recipe</td>
              <td>Rating</td> 
              <td>Draw</td>
      </tr>
    </thead>
      <tbody>
    </tbody>
  </table>
</div>

<!-- <button id="toggleB2" onclick="toggleTable2();toggleSlice2()">&#x100068;</button> -->

<div id="popupBackground">
  <div id="popup">
    <form id="menu-form">
      <div id="popInpContainer">
        <input type="text" placeholder="Grinder 1: Rotations" name="firstGrinder" id="formInput1">
          <input type="text" placeholder="Grinder 2: Clicks" name="secondGrinder" id="formInput2">
        <input type="text" placeholder="Enter IFTTT Key" name="iftttKey" id="formInput3">
      </div>
      <div id=popBtnContainer>
        <button onclick="clearLocalStorage(); reloadPage()" id="csvBtn">Wipe</button>
        <button onclick="openCsvOrFont()" id="fontBtn">Add File</button>
        <button type="submit" id="saveButtonMenu">Close</button>
      </div>
    </form>
  </div>
</div>
 
<div class="form-popup" id="myForm">
  <form action="/action_page.php" id="add-form" class="form-container" autocomplete="off" novalidate>
    <div id="headRow">
      <div id=title>Log Brew</div>
    </div>
    <div id="firstRow" style="position: relative;">
      <div id="inputIcon">S.</div>
      <input type="text" placeholder="Enter recipe details" name="log" id="logDetails" readonly autofocus>
      <div class="cursor"></div>
    </div>
    <div id="secondRow">
      <div id="inputIcon">R.</div>
      <select name="recipe" id="selectList" title="fix" required>
        <optgroup label="Inverted">
          <option value="TWi">Wendelboe inverted</option>
          <option value="JHi">Hoffmann inverted</option>
          <option value="OXi">Onyx inverted</option>
        </optgroup>
        <optgroup label="Aeropress">
          <option value="JH">James Hoffmann</option>
          <option value="TW" selected="selected">Tim Wendelboe</option>
          <option value="OX">Onyx Coffee</option>
          <option value="AO">Aeropress Original</option>
        </optgroup>
        <optgroup label="V60">
          <option value="TK">Tetsu Kasuya 4:6</option>
          <option value="OX">Onyx Coffee</option>
          <option value="JH">James Hoffmann</option>
        </optgroup>
        <optgroup label="Moka Pot">
          <option value="MK">James Hoffmann</option>
        </optgroup>
      </select>
    </div>
    <div id="thirdRow">
      <div id="inputIcon">T.</div>
      <input type="text" placeholder="Enter draw down" name="time" id="idTime" readonly>
    </div>
    <div id=buttonRow>
      <input type=reset onclick="myFormCloseButton()" value="Reset" id="resetButton">
      <button type="button" onclick="closeForm();closeFormEval()" id="saveButtonAdd">Close</button>
    </div>
    </form>
    <div id="keyboardContainer">
  <div id="kbFirstRow">
    <div>1</div>
    <div>2</div>
    <div>3</div>
    <div>4</div>
    <div>5</div>
  </div>
  <div id="kbSecondRow">
    <div>6</div>
    <div>7</div>
    <div>8</div>
    <div>9</div>
    <div>0</div>
  </div>
  <div id="kbThirdRow">
    <div>.</div>
    <div>,</div>
    <div>:</div>
    <div id="kbSpacebar">&nbsp</div>
    <div id="kbDelete">Del</div>
  </div>
</div>
  </div>
<div id="rating-popup">
  <div id="rating-container">
        <!-- <li id="ratingCancelButton">X</li> -->
    <ul id="rating-list">
      <li id="rating-item">1</li>
      <li id="rating-item">2</li>
      <li id="rating-item">3</li>
      <li id="rating-item">4</li>
      <li id="rating-item">5</li>
      <li id="rating-item">6</li>
    </ul>
  </div>
</div>

<div id="editingBG">
<div id='editingContainer'>
  <div id="editingButtonContainer">
    <input id='editingInput' title="fix">
    <button id='editingSave'>Save</button>
  </div>
</div>
</div>

<div id="detailsBG">
  <div id="detailsContainer">
    <div id="titleExportContainer">
      <h1 id="detailsTitle">Add Coffee</h1>
      <div id="coffeeExport" onclick="getCoffeeDataAsCSV()">Export</div>
    </div>
    <form id="coffeeForm">
      <select id="coffeeChoose" title="fix">
        <option value="" disabled selected>Choose Coffee</option>
        <!-- other coffee options go here -->
      </select>
      <input id="coffeeRoaster" placeholder="Roaster">
      <input id="coffeeName" placeholder="Name">
      <input id="coffeeOrigin" placeholder="Origin">
      <input id="coffeeProcess" placeholder="Process">
      <input id="coffeeVarietal" placeholder="Varietal">
      <input id="coffeeNotes" placeholder="Notes">
      <input id="coffeeAltitude" placeholder="Altitude">
      <input id="coffeeRoastDate" placeholder="Roast date">
      <div id="coffeeRating">
        <div>
        		&#x1002c2;
        </div>
        <div>
        		&#x1002c2;
        </div>
        <div>
        		&#x1002c2;
        </div>
        <div>
        		&#x1002c2;
        </div>
        <div>
        		&#x1002c2;
        </div>
      </div>
      <div id="detailsBts">
        <button id="coffeeDetailsSV">Save</button>
        <button id="removeCoffeeFromBrew">Unlink</button>
        <button id="deleteCoffee">Delete</button>
        <button id="coffeeDetailsCL">Close</button>
      </div>
    </form>
  </div>
</div>

<script>
if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('/service-worker.js').then(function(registration) {
        // Registration was successful
        //console.log('ServiceWorker registration successful with scope: ', registration.scope);
      }, function(err) {
        // Registration failed
        //console.log('ServiceWorker registration failed: ', err);
      });
    });
}

window.addEventListener('beforeunload', () => {
saveDataToLocalStorage("#grinder1 tbody tr", "coffeeLog1");
saveDataToLocalStorage("#grinder2 tbody tr", "coffeeLog2");
});

document.addEventListener('visibilitychange', () => {
  if (document.visibilityState === 'hidden') {
    saveDataToLocalStorage("#grinder1 tbody tr", "coffeeLog1");
    saveDataToLocalStorage("#grinder2 tbody tr", "coffeeLog2");
  }
});

function saveDataToLocalStorage(userGrinder, userLog) {
  const rows = document.querySelectorAll(userGrinder);
  const data = [];
  rows.forEach((row) => {
    const cells = row.querySelectorAll('td');
    const rowData = {
      date: cells[0].innerHTML,
      time: cells[1].innerHTML,
      setting: cells[2].innerHTML,
      gr: cells[3].innerHTML,
      ml: cells[4].innerHTML,
      degrees: cells[5].innerHTML,
      recipe: cells[6].innerHTML,
      rating: cells[7].innerHTML,
      drawdown: cells[8].innerHTML,
    };
    data.push(rowData);
  });
  localStorage.setItem(userLog, JSON.stringify(data));
}


function loadSelectedFont() {
  const fontData = localStorage.getItem('selectedFont');
  if (fontData) {
    const tableHeaders = document.querySelectorAll('thead tr td');
    const tableHeaderFontsize1 = document.querySelector('#grinder1 thead tr');
    const tableHeaderFontsize2 = document.querySelector('#grinder2 thead tr');
    const tableHeaders2 = document.querySelectorAll('#grinder2 thead tr td');
tableHeaderFontsize1.style.fontSize = '5vw'; 
tableHeaderFontsize2.style.fontSize = '5vw'; 

tableHeaders[0].textContent = '\u{100249}';
tableHeaders[1].textContent = '\u{10042b}';
tableHeaders[2].textContent = '\u{1007f2}';
tableHeaders[3].textContent = '\u{100b6d}';
tableHeaders[4].textContent = '\u{101384}';
tableHeaders[5].textContent = '\u{1001ec}';
tableHeaders[6].textContent = '\u{10155c}';
tableHeaders[7].textContent = '\u{1002c4}';
tableHeaders[8].textContent = '\u{10042f}';
tableHeaders2[0].textContent = '\u{100249}';
tableHeaders2[1].textContent = '\u{10042b}';
tableHeaders2[2].textContent = '\u{1013b4}';
tableHeaders2[3].textContent = '\u{100b6d}';
tableHeaders2[4].textContent = '\u{101384}';
tableHeaders2[5].textContent = '\u{1001ec}';
tableHeaders2[6].textContent = '\u{10155c}';
tableHeaders2[7].textContent = '\u{1002c4}';
tableHeaders2[8].textContent = '\u{10042f}';
  
const menuButtonIcon = document.querySelector('#menuButton')
  menuButtonIcon.textContent = '\u{100306}';
  menuButtonIcon.style.fontSize = "7vw";

const addButtonIcon = document.querySelector('#addBrew')
  addButtonIcon.textContent = '\u{10004c}'
  addButtonIcon.style.fontSize = '14vw';
  addButtonIcon.style.height = '18vw';
  addButtonIcon.style.width = '18vw';
  addButtonIcon.style.borderRadius = '50%';
  
// const cancelButtonIcon = document.querySelector('#ratingCancelButton')
//   cancelButtonIcon.textContent = '\u{100060}'

const resetButtonIcon = document.querySelector('#resetButton')
  resetButtonIcon.textContent = '\u{100060}';
  
const inputIcons = document.querySelectorAll('#inputIcon')
const inputIcon = document.querySelector('#inputIcon')
const addbrewForms = document.querySelectorAll('#myForm input, #myForm select')
    inputIcons[0].textContent ='\u{1007f2}';
    inputIcons[1].textContent ='\u{10155c}';
    inputIcons[2].textContent ='\u{10042f}';
    inputIcons[0].style.display = "flex";
    inputIcons[1].style.display = "flex";
    inputIcons[2].style.display = "flex";
    addbrewForms[0].style.width = "85%";
    addbrewForms[1].style.width = "85%";
    addbrewForms[2].style.width = "85%";
    
const exportButtonIcon = document.querySelector("#exportButton")
  exportButtonIcon.textContent = "\u{100202}"
  exportButtonIcon.style.fontSize = "6vw";
  
//const ratingIconsText = ["\u{1000ca}", "\u{1000cc}", "\u{1000ce}", "\u{1000d0}", "\u{1000d2}","\u{1000d4}"];
//const ratingIcons = document.querySelectorAll("#rating-item");
//ratingIcons.forEach((ratingIcon, i) => {
  //ratingIcon.style.fontWeight = "light";
//  ratingIcon.style.fontFamily = "iconMode";
//  ratingIcon.textContent = ratingIconsText[i];
//});


const css = `@font-face {
      font-family: 'iconMode';
      src: url('data:font/opentype;charset=utf-8;base64,${fontData}');
      font-display: swap;
    }`;
const style = document.createElement('style');
style.appendChild(document.createTextNode(css));
    document.head.appendChild(style);
  }
}

window.addEventListener('load', () => {
  loadSelectedFont()

  window.setTimeout(() => {

    loadLogs('coffeeLog1', '#grinder1 tbody');
    loadLogs('coffeeLog2', '#grinder2 tbody');
    showExportButton()

    const grinderTitle1 = localStorage.getItem('grinderName1')
    if (grinderTitle1) {
      document.querySelector('#grinder1Title').textContent = grinderTitle1
      document.querySelector('#formInput1').setAttribute('placeholder', 'Current: ' + grinderTitle1)
    }
    const grinderTitle2 = localStorage.getItem('grinderName2')
    if (grinderTitle2) {
      document.querySelector('#grinder2Title').textContent = grinderTitle2
      document.querySelector('#formInput2').setAttribute('placeholder', 'Current: ' + grinderTitle2)
    }
    const storedIftttKey = localStorage.getItem('iftttKey')
    if (storedIftttKey){
      const popupIftttInput = document.getElementById('formInput3')
      popupIftttInput.setAttribute('placeholder', 'IFTTT Key found!')
    }
  }, 5);
});


function loadLogs(userGrinder, selectedTable) {
  const data = JSON.parse(localStorage.getItem(userGrinder));
  const tableBody = document.querySelector(selectedTable);
  if (data) {
    // iterate through the data array from beginning to end
    for (let i = 0; i < data.length; i++) {
      const row = data[i];
      const tableRow = document.createElement('tr');
      const dateCell = document.createElement('td');
      dateCell.textContent = row.date;
      dateCell.setAttribute('data-row', i+1);
      dateCell.setAttribute('data-col', 1);

      const timeCell = document.createElement('td');
      timeCell.textContent = row.time;
      timeCell.setAttribute('data-row', i+1);
      timeCell.setAttribute('data-col', 2);
      
      const setCell = document.createElement('td');
      setCell.textContent = row.setting;
      setCell.onclick = function() {
      editTableCell(this, 'setCell' + i)}; // add unique ID to setCel
      setCell.setAttribute('data-row', i+1);
      setCell.setAttribute('data-col', 3);
      
      const grCell = document.createElement('td');
      grCell.textContent = row.gr;
      grCell.onclick = function() {
      editTableCell(this, 'grCell' + i); // add unique ID to setCell
      };
      grCell.setAttribute('data-row', i+1);
      grCell.setAttribute('data-col', 4);
      
      const mlCell = document.createElement('td');
      mlCell.textContent = row.ml;
      mlCell.onclick = function() {
      editTableCell(this, 'mlCell' + i); // add unique ID to setCell
      };
      mlCell.setAttribute('data-row', i+1);
      mlCell.setAttribute('data-col', 5);
      
      const degCell = document.createElement('td');
      degCell.textContent = row.degrees;
      degCell.onclick = function() {
      editTableCell(this, 'degCell' + i); // add unique ID to setCell
      };
      degCell.setAttribute('data-row', i+1);
      degCell.setAttribute('data-col', 6);
      
      const recCell = document.createElement('td');
      recCell.textContent = row.recipe;
      recCell.onclick = function() {
      editTableCell(this, 'recCell' + i); // add unique ID to setCell
      };
      recCell.setAttribute('data-row', i+1);
      recCell.setAttribute('data-col', 7);
      
      const ratCell = document.createElement('td');
      ratCell.textContent = row.rating;
      ratCell.setAttribute('data-row', i+1);
      ratCell.setAttribute('data-col', 8);
      ratCell.classList.add('rating-cell');
      ratCell.onclick = brewRating;
      
      const drawCell = document.createElement('td');
      drawCell.textContent = row.drawdown;
      drawCell.onclick = function() {
      editTableCell(this, 'drawCell' + i); // add unique ID to setCell
      };
      drawCell.setAttribute('data-row', i+1);
      drawCell.setAttribute('data-col', 9);
      tableRow.appendChild(dateCell);
      tableRow.appendChild(timeCell);
      tableRow.appendChild(setCell);
      tableRow.appendChild(grCell);
      tableRow.appendChild(mlCell);
      tableRow.appendChild(degCell);
      tableRow.appendChild(recCell);
      tableRow.appendChild(ratCell);
      tableRow.appendChild(drawCell);
      tableBody.appendChild(tableRow);//, tableBody.firstChild); // use appendChild instead of insertBefore
    }
  }
}

// =====    
const bodyDarkMode = document.querySelector('body');
  var metaTag = document.querySelector('meta[name="theme-color"]');

// Check if the system's color scheme is light or dark
  if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
    bodyDarkMode.classList.add('dark-theme');
    metaTag.setAttribute('content', '#151515');// add value for popup
  } else {
    metaTag.setAttribute('content', '#D1B888')
    bodyDarkMode.classList.remove('dark-theme');
  }

// Add a listener to toggle the theme when the system's color scheme changes
window.matchMedia('(prefers-color-scheme: dark)').addListener((event) => {
  if (event.matches) {
    bodyDarkMode.classList.add('dark-theme');
    metaTag.setAttribute('content', '#151515');// add value for popup
  } else {
    metaTag.setAttribute('content', '#D1B888')
    bodyDarkMode.classList.remove('dark-theme');
  }
})

// ===== Add brew form

const formPopup = document.getElementById("myForm")
const formContainer = formPopup.querySelector(".form-container");
const menuButtonTemp = document.querySelector('#menuButton')
const tempExportButton = document.querySelector('#exportButton')
const appTitle = document.querySelector('#appTitle')
const numberKeyboard = document.querySelector('#keyboardContainer');

function openForm() {
  formPopup.classList.add("blur-in")
  formContainer.classList.add("slide-in-blurred-top");
  numberKeyboard.classList.add("slide-in-blurred-bottom");
  formPopup.addEventListener("click", function (event) {
    if (event.target === formPopup) { // Check if the click happened on the background
      closeForm();
    }
  });
  formPopup.style.display = "block";
  document.getElementById("logDetails").focus();
  menuButtonTemp.style.display = 'none'
  tempExportButton.style.display = 'none'
  appTitle.style.display = "none";
  setTimeout(function() {
    formContainer.classList.remove("slide-in-blurred-top");
    numberKeyboard.classList.remove("slide-in-blurred-bottom");
  }, 550);
}

function closeForm() {
  formContainer.classList.add("slide-out-blurred-top");
  numberKeyboard.classList.add("slide-out-blurred-bottom");
  //formPopup.classList.add("fade-out");
  formPopup.classList.add("blur-out");
  
  menuButtonTemp.classList.add("fade-in");
  appTitle.classList.add("fade-in");
  
  setTimeout(() => {
  menuButtonTemp.style.display = 'block';
  appTitle.style.display = "block";
  showExportButton();
  }, 40);
  
  setTimeout(function() {
    formPopup.style.display = "none";
    formContainer.classList.remove("slide-out-blurred-top");
    numberKeyboard.classList.remove("slide-out-blurred-bottom");
    formPopup.classList.remove("blur-out");
    formPopup.removeEventListener('click', closeForm)
  }, 250);
}

function closeFormEval() {
  const tbody1 = document.querySelector("#grinder1 tbody");
  const tbody2 = document.querySelector("#grinder2 tbody");
  const currentDate = new Date().toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: '2-digit' });
  const currentTime = new Date().toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
  var logInput = document.getElementById("logDetails").value
  //console.log(logInput)
  var logCells = logInput.split(/\s/);
  //console.log(logCells)
  var selectList = document.getElementById("selectList").value;
  
  var idTime = document.getElementById("idTime").value
  let tr;
  let rows;
  if (logInput.length>0) {
    if (logInput.includes(".")){
      tr = tbody1.insertRow(0);
      rows = tbody1.rows;
    } else {
      tr = tbody2.insertRow(0); 
      rows = tbody2.rows;
    }
    const cells = [currentDate, currentTime, logCells[0], logCells[1], logCells[2], logCells[3], selectList, "3", idTime];
    cells.forEach((cell, cellIndex) => {
      const td = tr.insertCell();
      td.textContent = cell;
      if (cellIndex === 7) {
        td.classList.add('rating-cell');
        td.onclick = brewRating;
      }
      if (cellIndex >= 2 && cellIndex <= 6 || cellIndex === 8) {
        td.onclick = () => editTableCell(td);
        //console.log(td.onclick)
      }
      td.setAttribute('data-row', 0);
      td.setAttribute('data-col', cellIndex);
    });
    // adjust data-row and data-col for all cells in table body
    for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {
      const cells = rows[rowIndex].cells;
      for (let cellIndex = 0; cellIndex < cells.length; cellIndex++) {
        const cell = cells[cellIndex];
        cell.setAttribute('data-row', rowIndex);
        cell.setAttribute('data-col', cellIndex);
      }
    }
  }
  setTimeout(() => {
    var logInputReset = document.getElementById("logDetails");
    var selectListReset = document.getElementById("selectList");
    var idTimeReset = document.getElementById("idTime");
      logInputReset.value = "";
      selectListReset.selectedIndex = 4;
      idTimeReset.value = "";
      myFormCloseButton()
      initializeTableSwipe("#grinder1 tbody tr", "#roundedCorners1", "#delete", "#details")
      initializeTableSwipe("#grinder2 tbody tr", "#roundedCorners2", "#delete2", "#details2")
  }, 50);
}
// ====== END brew form
// ===== RATING =====
const ratingCells = document.querySelectorAll('.rating-cell');
const ratingPopup = document.getElementById('rating-popup');
const ratingContainer = document.getElementById('rating-container');
const ratingItems = document.querySelectorAll('#rating-list li');

function closeRating() {
  const selectedCell = document.querySelector('.selected-cell');
    ratingContainer.classList.replace('slide-in-blurred-right', 'slide-out-blurred-right'); 
    setTimeout(() => {
      ratingContainer.style.display = 'none';
      ratingPopup.style.display = "none";
      ratingContainer.classList.replace('slide-out-blurred-right', 'slide-in-blurred-right');
      selectedCell.classList.remove('editingMode');
      selectedCell.classList.remove('selected-cell');
      ratingPopup.removeEventListener('click', closeRating)
    }, 250);
}

function brewRating() {
  if(swiped===true){} else {
  ratingPopup.addEventListener("click", function (event) {
    if (event.target === ratingPopup) {
        closeRating();
    }
  });

  ratingContainer.classList.add('slide-in-blurred-right'); 
  const row = this.getAttribute('data-row');
  const col = this.getAttribute('data-col');

  const cellRect = this.getBoundingClientRect();
  const ratingContainerHalf = vwToPx(93)/2;
  console.log(ratingContainerHalf)
  const topOffset = cellRect.bottom - cellRect.width/2 -5 - ratingContainerHalf;
  
  const inUpperThird = window.innerHeight/3;
  const inLowerThird = (window.innerHeight/2.5)*2;

  if (cellRect.bottom < inUpperThird) {
    ratingContainer.style.top = vwToPx(30)+"px";
  } else if (cellRect.bottom > inLowerThird) {
    ratingContainer.style.top = vwToPx(106)+"px";
  } else {
  ratingContainer.style.top = topOffset+"px";
 } 
  ratingPopup.style.display = "block";
  ratingContainer.style.display = 'flex';
  ratingContainer.classList.add('active');

  const selectedCell = this;
    selectedCell.classList.add('editingMode');
    selectedCell.classList.add('selected-cell');
    ratingItems.forEach(item => {
      item.addEventListener('click', function selectRating() {
        const selectedRating = this.innerText;
        const changeCell = document.querySelector('.selected-cell');
        changeCell.innerText = selectedRating;
        closeRating();
        ratingItems.forEach(item => item.removeEventListener('click', selectRating));
      });
    });
  // quit with swipes
  let startX, startY, distX, distY;
  ratingContainer.addEventListener('touchstart', function(e) {
    startX = e.touches[0].pageX;
    startY = e.touches[0].pageY;
  });
  ratingContainer.addEventListener('touchmove', function(e) {
    distX = e.touches[0].pageX - startX;
    distY = e.touches[0].pageY - startY;
    if (Math.abs(distX) > Math.abs(distY) && distX > 0) {
      closeRating();
    }
  });
  ratingContainer.addEventListener('touchend', function(e) {
    startX = null;
    startY = null;
    distX = null;
    distY = null;
  });
}// if swiped
}
// ====== END RATING =====
// ========= popup =====
const backgroundPopup = document.body.querySelector('#popupBackground')
const popup = document.body.querySelector('#popup')

function closePopup() {
    backgroundPopup.classList.remove('blur-in');
    popup.classList.remove('slide-in-blurred-top');

    backgroundPopup.classList.add('blur-out');
    popup.classList.add('slide-out-blurred-top');
    menuButtonTemp.classList.add("fade-in");
    appTitle.classList.add("fade-in");
    
  		setTimeout(() => {
  		menuButtonTemp.style.display = 'block';
  		appTitle.style.display = "block";
  		showExportButton();
  		}, 40);
  
    setTimeout(() => {
      backgroundPopup.classList.remove('blur-out');
      popup.classList.remove('slide-out-blurred-top');
      backgroundPopup.style.display= 'none';
      popup.style.display= 'none';
      backgroundPopup.removeEventListener('click', closePopup)
    }, 350);
}

function showPopup() {
  backgroundPopup.addEventListener("click", function (event) {
    if (event.target === backgroundPopup) { // Check if the click happened on the background
      closePopup();
    }
  });

  backgroundPopup.classList.add('blur-in');
  popup.classList.add('slide-in-blurred-top');
  menuButtonTemp.style.display = 'none'
  tempExportButton.style.display = 'none'
  appTitle.style.display = 'none'
  backgroundPopup.style.display= 'block';
  popup.style.display= 'block';
  
  const form = document.getElementById('menu-form');
  form.addEventListener('submit', (event) => {
    event.preventDefault();
    const setGrinder1 = document.querySelector('[name="firstGrinder"]');
    if (setGrinder1.value!==""){
    localStorage.setItem('grinderName1',setGrinder1.value);
    }
    
    const setGrinder2 = document.querySelector('[name="secondGrinder"]');
    if (setGrinder2.value!==""){
    localStorage.setItem('grinderName2',setGrinder2.value);
    }
    const setIftttKey = document.querySelector('[name="iftttKey"]');
    if (setIftttKey.value!==""){
    localStorage.setItem('iftttKey', setIftttKey.value);
    }
    closePopup();
  });
}
// === import 
function openCsvOrFont() {
  const fileInput = document.createElement('input');
  fileInput.type = 'file';
  fileInput.accept = '.csv,.ttf,.otf';
  fileInput.onchange = () => {
    const file = fileInput.files[0];
    const reader = new FileReader();
    reader.onload = () => {
      const fileData = reader.result;
      if (file.type === 'text/csv') {
        //console.log(file.name)
        addCsvToTable(fileData);
        reloadPage();
      } else if (file.type === 'font/ttf' || file.type === 'font/otf') {
        const reader = new FileReader();
        reader.onload = () => {
          const fontData = reader.result.split(',')[1];
          try {
            localStorage.setItem('selectedFont', fontData);
            alert('Selected font saved to local storage!');
            reloadPage();
          } catch (e) {
            alert('Error saving font to local storage: ' + e.message);
          }
        };
        reader.readAsDataURL(file);
      }
    };
    reader.readAsText(file);
  };
  fileInput.click();
}

function addCsvToTable(csvData) {
  const checkImportGrinder = csvData.split("\n")[0];
  //console.log(checkImportGrinder)
  let tbodyTemp = document.querySelector('#grinder2 tbody');
  if (checkImportGrinder.includes(".",8)===true) {
    tbodyTemp = document.querySelector('#grinder1 tbody');
  }
  //console.log(tbodyTemp)
  const rows = csvData.split('\n').map(row => row.split(';'));
  rows.slice(0).forEach((row, rowIndex) => {
    const tr = tbodyTemp.insertRow();
    row.forEach((cell, cellIndex) => {
      const td = tr.insertCell();
      td.textContent = cell;
    });
  });
}

// === tools
function checkStoredLog() {
  if (!localStorage.getItem('coffeeLog1')) {
    setTimeout(() => {
      showPopup();
      }, 250);
  }
}

checkStoredLog()

function reloadPage() {
  setTimeout(() => {
    location.reload();
  }, 200)
}

function clearLocalStorage() {
  localStorage.clear();
  const tbody1 = document.querySelector('#grinder1 tbody');
  const tbody2 = document.querySelector('#grinder2 tbody');
  tbody1.innerHTML = '';
  tbody2.innerHTML = '';
}
// ====  edit cell ===
const editingContainer = document.querySelector('#editingContainer');
const editingBG = document.querySelector('#editingBG');
const editingInput = document.querySelector('#editingInput');
const saveButton = document.querySelector('#editingSave');
//const cancelButton = document.querySelector('#editingCancel');
var currentCell;

function closeEditCell() {
  editingContainer.classList.remove('slide-in-edit');
    editingContainer.classList.add('slide-out-edit');
    currentCell.classList.remove('editingMode');
    setTimeout(() => {
      //editingContainer.style.display = 'none'
      editingBG.style.display = 'none';
      editingContainer.classList.remove('slide-out-edit');
      saveButton.removeEventListener('click', onSaveClick);
      //cancelButton.removeEventListener('click', onCancelClick);
      editingBG.removeEventListener('click', closeEditCell)
    }, 240); 
}

function onSaveClick() {
  currentCell.textContent = editingInput.value;
  closeEditCell();
//  editingContainer.classList.remove('slide-in-edit');
//  editingContainer.classList.add('slide-out-edit');
//  currentCell.classList.remove('editingMode');
//  setTimeout(() => {
//    editingBG.style.display = 'none';
//    saveButton.removeEventListener('click', onSaveClick);
//  }, 240); 
}

function vwToPx(vw) {
      const viewportWidth = window.innerWidth || document.documentElement.clientWidth;
      return (vw * viewportWidth) / 100;
}

function editTableCell(cell) {
  const rC1Left = document.querySelector('#roundedCorners1').getBoundingClientRect().left;
  const rC1Right = document.querySelector('#roundedCorners1').getBoundingClientRect().right;

  if (swiped === true) {
    // Handle swiped case
  } else {
    editingBG.addEventListener("click", function (event) {
      if (event.target === editingBG) { // Check if the click happened on the background
        closeEditCell();
      }
    });

    currentCell = cell;
    cell.classList.add('editingMode');
    editingContainer.classList.add('slide-in-edit');
    const cellRect = cell.getBoundingClientRect();
    const editingContainerWidth = vwToPx(54);
    const cellWidth = cellRect.width;
    
    if (cellRect.left<= editingContainerWidth/2){
      editingContainer.style.left = `${rC1Left+50}px`;
      console.log("left boundary")
    } else if (cellRect.right >= rC1Right - editingContainerWidth/2) {
      editingContainer.style.left = `${vwToPx(97)-editingContainerWidth}px`;
      console.log("right boundary")
    } else {
      editingContainer.style.left = `${cellRect.left + cellRect.width/2 - editingContainerWidth/2}px`;
      console.log("no boundary")
    }

    const topOffset = cellRect.top + cellRect.height + 8;
    const isAboveMiddle = (cellRect.bottom < window.innerHeight / 2);
    if (isAboveMiddle) {
      editingContainer.style.top = `${topOffset}px`;
    } else {
      editingContainer.style.top = `${cellRect.top - 70}px`;
    }
    editingBG.style.display = 'block';
    editingInput.value = cell.textContent;
    saveButton.addEventListener('click', onSaveClick);
  }
}



// ===== export as csv every three days
const lastBackupStr = localStorage.getItem('lastBackup');
const lastBackupDate = new Date(lastBackupStr);
const currentDate = new Date();

function showExportButton() {
  const exportButtontemp= document.querySelector("#exportButton");
  const timeDiff = currentDate.getTime() - lastBackupDate.getTime();
  const daysDiff = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
  if (daysDiff < 3) {
    exportButtontemp.classList.add('fade-out');
    exportButtontemp.style.display = "none";
    return
  }
  const tbody = document.querySelector('tbody');
  if (!tbody || !tbody.querySelectorAll('td').length) {
    return}
    exportButtontemp.classList.add('fade-in');
  		exportButtontemp.style.display = "block";
  //sendTableData();
}

function shareCSV() {
  const grinder1Tbody = document.querySelector('#grinder1 tbody');
  const grinder2Tbody = document.querySelector('#grinder2 tbody');
  const hasGrinder1Data = grinder1Tbody && grinder1Tbody.querySelectorAll('td').length;
  const hasGrinder2Data = grinder2Tbody && grinder2Tbody.querySelectorAll('td').length;
  if (!hasGrinder1Data && !hasGrinder2Data) {
    console.log("no data in tables")
    return;
  }
  const grinder1Rows = hasGrinder1Data ? Array.from(grinder1Tbody.querySelectorAll('tr'))
    .map(row => Array.from(row.querySelectorAll('td'))
      .map(cell => cell.textContent.replace(/;/g, '\;'))
      .join(';')
    ) : [];
  const grinder2Rows = hasGrinder2Data ? Array.from(grinder2Tbody.querySelectorAll('tr'))
    .map(row => Array.from(row.querySelectorAll('td'))
      .map(cell => cell.textContent.replace(/;/g, '\;'))
      .join(';')
    ) : [];
  const grinder1CSVStr = grinder1Rows.join('\n');
  const grinder2CSVStr = grinder2Rows.join('\n');

  if (localStorage.getItem('iftttKey')){
    const key = localStorage.getItem('iftttKey')
    sendGetRequest(key, grinder1CSVStr, grinder2CSVStr);
  }

  const grinder1FileName = `${localStorage.getItem('grinderName1')} ${currentDate.toLocaleDateString('de-DE')}_backup.csv`;
  const grinder2FileName = `${localStorage.getItem('grinderName2')} ${currentDate.toLocaleDateString('de-DE')}_backup.csv`;
  const shareData = {
    files: []
  };
  if (hasGrinder1Data) {
    const grinder1File = new File([grinder1CSVStr], grinder1FileName, {type: 'text/csv'});
    shareData.files.push(grinder1File);
  }
  if (hasGrinder2Data) {
    const grinder2File = new File([grinder2CSVStr], grinder2FileName, {type: 'text/csv'});
    shareData.files.push(grinder2File);
  }
   navigator.share(shareData)
    .then(() => {
      const grinder1ExportButton = document.querySelector("#grinder1 #exportButton");
      const grinder2ExportButton = document.querySelector("#grinder2 #exportButton");
      if (grinder1ExportButton) {
        grinder1ExportButton.style.display = "none";
      }
      if (grinder2ExportButton) {
        grinder2ExportButton.style.display = "none";
      }
      localStorage.setItem('lastBackup', currentDate.toISOString());
      alert('Data shared successfully.');
    })
    .catch((error) => alert('Error sharing data:', error));
}

function sendGetRequest(apiKey, grinder1CSVStr, grinder2CSVStr) {
  const script = document.createElement('script');
  const url = `https://maker.ifttt.com/trigger/CoffeeLog/with/key/${apiKey}?&value1=${encodeURIComponent(grinder1CSVStr)}&value2=${encodeURIComponent(grinder2CSVStr)}`;
  //console.log(url);

  script.src = url;
  document.body.appendChild(script);
}

// export saved coffees ======
function getCoffeeDataAsCSV() {
  const coffeeData = [];
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key.startsWith("coffee.")) {
      const value = JSON.parse(localStorage.getItem(key));
      coffeeData.push(value);
    }
  }

  const headers = Object.keys(coffeeData[0]);
  const csv = [
    headers.join(";"),
    ...coffeeData.map((item) =>
      headers.map((header) => JSON.stringify(item[header])).join(";")
    ),
  ].join("\n");
  console.log(csv);
  if (navigator.share) {
    navigator.share(csv);
  } else {
    console.log("Sharing is not supported on this browser.");
  }
}


// ==== details // delete ====
const detailsBG = document.querySelector('#detailsBG');
const detailsContainer = document.querySelector('#detailsContainer');
let firstTwoCells;
let deleteCells;
const swipeDetails = document.getElementById('details');
const swipeDelete = document.getElementById('deleteB');
const coffeeDetailsSV = document.getElementById('coffeeDetailsSV');
const coffeeDetailsCL = document.getElementById('coffeeDetailsCL');
var currentRow = null;
let swiped = false;

function initializeTableSwipe(grinderTbodyTr, roundedCornersSelect, deleteButton, detailsButton) {
  const tBodyRows = document.querySelectorAll(grinderTbodyTr);
  let touchStartX = null;
  let touchMoveX = null;
  // let swiped = false;
  const rC = document.querySelector(roundedCornersSelect);
  const deleteB = document.querySelector(deleteButton);
	const details = document.querySelector(detailsButton);
  //const rC2 = document.querySelector('#roundedCorners2');
  var cells = null;

// const table = document.querySelector('#grinder1');
// const tableTop = table.offsetTop;
// const tableHeight = table.offsetHeight;

// deleteB.style.top = `${tableTop}px`;
// deleteB.style.height = `${tableHeight}px`;

// details.style.top = `${tableTop}px`;
// details.style.height = `${tableHeight}px`;


tBodyRows.forEach(row => {
row.addEventListener("touchstart", function(event) {
  touchStartX = event.touches[0].clientX;
  touchMoveX = touchStartX;
          //console.log(swiped)
});

row.addEventListener("touchmove", function(event) {
if (swiped===false){
  deleteB.style.top = `${row.offsetTop}px`;
  deleteB.style.height = `${row.offsetHeight}px`;
  console.log(row.offsetHeight);
  details.style.top = `${row.offsetTop}px`;
  details.style.height = `${row.offsetHeight}px`;
  //row.style.border = "solid 1pt #D7C29C";
};
  touchMoveX = event.touches[0].clientX;
  const distance = touchMoveX - touchStartX;

//  tBodyRows.forEach((r) => {
   // if (r !== row) {
  //    r.style.transform = 'translateX(0px)';
 //   }
//  });
 if (swiped === true) {
 } else if (distance > 0 && distance <= 100) {// === Details init
      details.style.display = "flex";
      details.style.transform = `translateX(${distance/2}px)`;
      row.style.transform = `translateX(${distance/1.5}px)`;
  
  } else if (distance < 0 && distance >= -100) {// ==== Delete init
      deleteB.style.display = "flex";
      deleteB.style.transform = `translateX(${distance/2}px)`;
      row.style.transform = `translateX(${distance/1.5}px)`;
  
  } else if (distance > 100 && swiped===false) {// ==== Details
      rC.style.overflowY = "hidden";
      details.style.transform = `translateX(17vw)`;
      row.style.transform = `translateX(17%)`;
  } else if (distance < -100 && swiped ===false) {// ==== Delete
      rC.style.overflowY = "hidden";
      deleteB.style.transform = 'translateX(-17vw)';
      row.style.transform = `translateX(-17%)`;
      rowDelete = event.currentTarget;
      if (distance < -350) {clickOnDeleteB()}
  } 
});

row.addEventListener("touchend", function(event) {
const distance = touchMoveX - touchStartX;
 if (distance > 100 && swiped === false) {// ==== Details
      rC.style.overflowY = "hidden";
      details.style.transform = `translateX(17vw)`;
      row.style.transform = `translateX(17%)`;
      const cells = event.currentTarget.querySelectorAll('td');
      firstTwoCells = `${cells[0].textContent} ${cells[1].textContent}`;
      console.log(firstTwoCells)
      currentRow = row;
      swiped = true;
      details.addEventListener('click', showDetails);
    
  } else if (distance < -100 && swiped ===false ) {// ==== Delete
      rC.style.overflowY = "hidden";
      deleteB.style.transform = 'translateX(-17vw)';
      row.style.transform = `translateX(-17%)`;
      rowDelete = event.currentTarget;
      //console.log(rowDelete);
      //console.log(swiped)
      deleteB.addEventListener('click', clickOnDeleteB)
      swiped = true;

  } else {// === user did not swipe enough or taps anywhere, slide row back
      tBodyRows.forEach((r) => {
        r.style.transform = 'translateX(0px)'//
      });
      deleteB.style.transform = 'translateX(0px)';
      details.style.transform = 'translateX(0px)';
      rC.style.overflowY = "scroll";
      setTimeout(() => {
        deleteB.style.display = "none";
        details.style.display = "none";
        swiped = false;
      },300);
    }// if ende
  });// touchend ende

function clickOnDeleteB() { 
  deleteB.style.width = "230vw"
  deleteB.style.transition = "transform 0.3s ease-in-out, opacity 0.3s ease 0.29s";
  rowDelete.style.transform = "translateX(-100%)";
  deleteB.style.opacity= "0";
  deleteB.style.transform = 'translateX(-215vw)';
  rC.style.overflowY = "scroll";
  // swiped = false;
  setTimeout(() => {
    rowDelete.remove();
    //console.log(rowDelete);
    deleteB.style.display = "none";
    deleteB.style.width = "21vw";
    deleteB.style.opacity="1";
    deleteB.style.transform = "translateX(0vw)";
    deleteB.style.left = '92vw';
    rC.style.overflowY = "scroll";
    swiped = false;
  }, 590);
    deleteB.removeEventListener('click', clickOnDeleteB)
 }// ende clickonDelete
}); //for each row
};// == function Swipe

setTimeout(() => {
  initializeTableSwipe("#grinder1 tbody tr", "#roundedCorners1", "#delete", "#details")
  initializeTableSwipe("#grinder2 tbody tr", "#roundedCorners2", "#delete2", "#details2")
}, 300);

function closeDetails() {
  const inputs = document.querySelectorAll('#coffeeForm input');
  const coffeeSelect = document.querySelector('#coffeeForm select')
  inputs.forEach(field => {
    field.value = "";
  })
  coffeeSelect.selectedIndex = 0;
  fillStars(0,false);

  detailsBG.classList.add('blur-out');
  detailsContainer.classList.add('slide-out-blurred-top');
  
  		setTimeout(() => {
  		menuButtonTemp.style.display = 'block';
  		appTitle.style.display = "block";
  		showExportButton();
  		}, 40);

  details.style.transform = "translateX(0px)";
  currentRow.style.transform = "translateX(0px)";

  setTimeout(() => {
    detailsBG.style.display = "none";
    detailsContainer.style.display = "none"
    details.style.display="none";
    detailsBG.classList.remove('blur-out');
    detailsContainer.classList.remove('slide-out-blurred-top');
    currentRow = null;
    firstTwoCells = null
    details.removeEventListener('click', showDetails);
    detailsBG.removeEventListener("click", closeDetails);
    swiped = false;
  }, 350);
}

let currentStars = 0;
const coffeeRatingDiv = document.getElementById("coffeeRating");
const starDivs = coffeeRatingDiv.querySelectorAll("div");
function fillStars(num, half) {
  starDivs.forEach((starDiv, i) => {
    if (i < num) {
      starDiv.innerHTML = "&#x1002c3;";
    } else if (i == num && half) {
      starDiv.innerHTML = "&#x1002c4;";
    } else {
      starDiv.innerHTML = "&#x1002c2;";
    }
  });
  if (half === true) {
    currentStars = num + "." + 5
  } else {
  currentStars = num + "." + 0
  }
}

const unlinkButton = document.querySelector('#removeCoffeeFromBrew')
const deleteCoffeeButton = document.querySelector('#deleteCoffee')

function unlinkCoffee(inputLog) {
  localStorage.removeItem(inputLog);
  const inputs = document.querySelectorAll('#coffeeForm input');
  const coffeeSelect = document.querySelector('#coffeeForm select')
  inputs.forEach(field => {
    field.value = "";
  })
  coffeeSelect.selectedIndex = 0;
  fillStars(0,false);
  unlinkButton.removeEventListener("click", unlinkCoffee);
  unlinkButton.style.opacity = "0.7";
}

function deleteCoffee(inputCoffee) {
  event.preventDefault();
  localStorage.removeItem(inputCoffee);
  const inputs = document.querySelectorAll('#coffeeForm input');
  const coffeeSelect = document.querySelector('#coffeeForm select')
  inputs.forEach(field => {
    field.value = "";
  })
  coffeeSelect.selectedIndex = 0;
  fillStars(0,false);
  
  const itemNames = [];
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (/^\d/.test(key)) {
      const value = localStorage.getItem(key);
      if (value === inputCoffee) {
        itemNames.push(key); // Add the key to the array
      }
    }
  }
  console.log(itemNames)
  itemNames.forEach(item => {
    localStorage.removeItem(item);
  })
  console.log("deleted");

  populateSelect();
  closeDetails();
  setTimeout(()=> {
  deleteCoffeeButton.removeEventListener("click", deleteCoffee);
  deleteCoffeeButton.style.opacity = "0.7";
}, 400);
}

function showDetails() {
  detailsBG.classList.add('blur-in');
  detailsContainer.classList.add('slide-in-blurred-top');
  menuButtonTemp.style.display = 'none';
  tempExportButton.style.display = 'none';
  appTitle.style.display = 'none';
  detailsBG.style.display = "block";
  detailsContainer.style.display = "block"
  detailsBG.addEventListener("click", function (event) {
      if (event.target === detailsBG) { // Check if the click happened on the background
        closeDetails();
      }
    });
    
  const coffeeRatingDiv = document.getElementById("coffeeRating");
  const starDivs = coffeeRatingDiv.querySelectorAll("div");

  coffeeRatingDiv.addEventListener("touchstart", (event) => {
    event.preventDefault(); // prevent scrolling
    handleTouch(event.touches[0], 12);
  });

  coffeeRatingDiv.addEventListener("touchmove", (event) => {
    event.preventDefault(); // prevent scrolling
    handleTouch(event.touches[0], 8);
  });

  function handleTouch(touch, divisor) {
    const boundingRect = coffeeRatingDiv.getBoundingClientRect();
    const touchX = touch.clientX - boundingRect.left;
    const starWidth = boundingRect.width / divisor; // adjust for half stars
    const filledStars = Math.floor(touchX / starWidth);
    const halfStar = touchX - filledStars * starWidth > starWidth / 2;
    // const rating = filledStars + (halfStar ? 0.5 : 0);
    // console.log(`Current rating: ${rating}`);
    if (filledStars < 0) {
      fillStars(0, false);
    } else if (filledStars >= 5) {
      fillStars(5, false);
    } else {
      fillStars(filledStars, halfStar);
    }
  }
    
  setTimeout(() => {
    detailsBG.classList.remove('blur-in');
    detailsContainer.classList.remove('slide-in-blurred-top');
  }, 400);

  const svButton = document.querySelector('#coffeeDetailsSV')
  const clButton = document.querySelector('#coffeeDetailsCL')

  svButton.addEventListener('click', () => {
    event.preventDefault()
    linkLogWithCoffee(firstTwoCells);
    saveCoffee();
    setTimeout(() => {
    closeDetails();
  },50);
  });

  clButton.addEventListener('click', () => {
    event.preventDefault()
    closeDetails();
  });

  const selectedLog = firstTwoCells;
  const linkedCoffee = localStorage.getItem(selectedLog);

  if (linkedCoffee) {
    const selectedCoffeeJSON = localStorage.getItem(linkedCoffee);
    const selectedCoffee = JSON.parse(selectedCoffeeJSON);
    document.getElementById('coffeeRoaster').value = selectedCoffee.coffeeRoaster;
    document.getElementById('coffeeName').value = selectedCoffee.coffeeName;
    document.getElementById('coffeeOrigin').value = selectedCoffee.coffeeOrigin;
    document.getElementById('coffeeProcess').value = selectedCoffee.coffeeProcess;
    document.getElementById('coffeeVarietal').value = selectedCoffee.coffeeVarietal;
    document.getElementById('coffeeNotes').value = selectedCoffee.coffeeNotes;
    document.getElementById('coffeeAltitude').value = selectedCoffee.coffeeAltitude;
    document.getElementById('coffeeRoastDate').value = selectedCoffee.coffeeRoastDate;
    const coffeeRatingJSON = selectedCoffee.coffeeRating.split(".")
    fillStars(coffeeRatingJSON[0], coffeeRatingJSON[1])
    
    unlinkButton.style.opacity = "1";
    unlinkButton.addEventListener('click', () => {
      event.preventDefault()
      unlinkCoffee(selectedLog);
    });
    deleteCoffeeButton.style.opacity = "1";
    deleteCoffeeButton.addEventListener('click', () => {
      event.preventDefault()
      deleteCoffee("coffee." + document.getElementById('coffeeName').value);
    });
  } else {
    unlinkButton.style.opacity = "0.7";
    deleteCoffeeButton.style.opacity = "0.7";
  }
}

const selectElement = document.getElementById('coffeeChoose');

selectElement.addEventListener('change', (event) => {
  const selectedCoffeeName = event.target.value;
  const selectedCoffeeJSON = localStorage.getItem('coffee.'+selectedCoffeeName);
  const selectedCoffee = JSON.parse(selectedCoffeeJSON);

  document.getElementById('coffeeRoaster').value = selectedCoffee.coffeeRoaster;
  document.getElementById('coffeeName').value = selectedCoffee.coffeeName;
  document.getElementById('coffeeOrigin').value = selectedCoffee.coffeeOrigin;
  document.getElementById('coffeeProcess').value = selectedCoffee.coffeeProcess;
  document.getElementById('coffeeVarietal').value = selectedCoffee.coffeeVarietal;
  document.getElementById('coffeeNotes').value = selectedCoffee.coffeeNotes;
  document.getElementById('coffeeAltitude').value = selectedCoffee.coffeeAltitude;
  document.getElementById('coffeeRoastDate').value = selectedCoffee.coffeeRoastDate;
  const coffeeRatingJSON = selectedCoffee.coffeeRating.split(".")
  fillStars(coffeeRatingJSON[0], coffeeRatingJSON[1])

  deleteCoffeeButton.style.opacity = "1";
  deleteCoffeeButton.addEventListener('click', () => {
    event.preventDefault()
    deleteCoffee("coffee." + document.getElementById('coffeeName').value);
  });
});

function saveCoffee() {
  const inputs = document.querySelectorAll('#coffeeForm input');
  const coffeeSelect = document.querySelector('#coffeeForm select');
  const coffee = {};

  // Check if coffeeName is empty
  const coffeeNameInput = document.querySelector('#coffeeName');
  if (coffeeNameInput.value.trim() === '') {
  return; // Exit the function if coffeeName is empty
  }
	
  //alert(currentStars);
  inputs.forEach(input => {
    coffee[input.id] = input.value;
  });
  // =============
  coffee['coffeeRating'] = currentStars;
  // ===================================
  localStorage.setItem('coffee.'+coffeeName.value, JSON.stringify(coffee));
  coffeeSelect.selectedIndex = 0;
  populateSelect();
}


function linkLogWithCoffee(input) {
  const keyLog = input;
  const valueCoffee = document.querySelectorAll('#coffeeForm input')[1].value
  localStorage.setItem(keyLog, "coffee."+valueCoffee)
}

 function populateSelect() {
   const coffeeSelect = document.getElementById('coffeeChoose');
   const coffeeData = Object.keys(localStorage)
     .filter(key => key.startsWith('coffee.'))
     .map(key => JSON.parse(localStorage.getItem(key)));

   const roasterLookup = {};
   coffeeData.forEach(coffee => {
     if (!roasterLookup[coffee.coffeeRoaster]) {
       roasterLookup[coffee.coffeeRoaster] = [];
     }
     roasterLookup[coffee.coffeeRoaster].push(coffee);
   });

   coffeeSelect.innerHTML = "<option selected>Choose Coffee</option>"; // disabled

   for (const [roaster, coffees] of Object.entries(roasterLookup)) {
     const optgroup = document.createElement('optgroup');
     optgroup.label = roaster;
     coffees.forEach(coffee => {
       const option = document.createElement('option');
       option.value = coffee.coffeeName;
       option.text = coffee.coffeeName;
       optgroup.appendChild(option);
     });
     coffeeSelect.appendChild(optgroup);
   }
 }

populateSelect()

// ==== event listeners input change => button text
const addBrewSave = document.querySelector('#saveButtonAdd');
const menuSave = document.querySelector('#saveButtonMenu');
const menuForm = document.querySelector('#menu-form');

menuForm.addEventListener('input', (event) => {
  if (event.target.value.trim() === '') {
    menuSave.style.fontWeight = "normal"
    menuSave.textContent = "Close";
  } else {
    menuSave.style.fontWeight = "bold"
    menuSave.textContent = "Save";
  }
});

function myFormCloseButton() {
  addBrewSave.style.fontWeight = "normal"
  addBrewSave.textContent = "Close"
}

function myFormSaveButton() {
  addBrewSave.style.fontWeight = "bold"
  addBrewSave.textContent = "Save"
}

// ========== keyboard 
// const keyboardButtons = document.querySelectorAll('#keyboardContainer div div');
// const cursor = document.querySelector('.cursor');
var input;

function setInputValueOnClick() {
  const keyboardButtons = document.querySelectorAll('#keyboardContainer div div');
  keyboardButtons.forEach(keyboardButton => {
    keyboardButton.addEventListener('touchstart', (event) => {
      keyboardButton.classList.add('pressed');
      setTimeout(() => {
        keyboardButton.classList.remove('pressed');
      }, 150);
      event.preventDefault();

      var input = document.activeElement;
      if (input.tagName === 'INPUT') {

        if (keyboardButton.textContent === "Del") {
          input.value = input.value.slice(0, -1);
          setTimeout(() => {
            moveCursor();
          }, 10);
        } else {
          input.value += keyboardButton.textContent;
          setTimeout(() => {
            moveCursor();
          }, 10);
        }
      }
    });
  });
}

function moveCursor() { 
  var input = document.activeElement;
  const cursor = document.querySelector('.cursor');
  
  var calcText = document.createElement("span");
    document.body.appendChild(calcText);
    calcText.style.fontFamily = "system-ui";
    calcText.style.fontSize = 5 + "vw";
    calcText.style.height = 'auto';
    calcText.style.width = 'auto';
    calcText.style.position = 'absolute';
    calcText.style.whiteSpace = 'normal';
    calcText.textContent = input.value;
    textWidth = Math.ceil(calcText.clientWidth);
    calcText.style.display = "none";
  
  var rect = input.getBoundingClientRect();
  var textPadding = parseFloat(getComputedStyle(input).paddingLeft);
  var x = rect.left - 32 + textPadding + textWidth;
  var y = rect.top-160; 
    cursor.style.left = `${x}px`;
    cursor.style.top = `${y}px`;
    cursor.style.display = "block";

  input.addEventListener('blur', () => {
      //input = document.activeElement;
      cursor.style.display = "none";
      calcText.remove();
  });
  //console.log(document.activeElement.id);
  if (input.value > 0 ) {
    myFormSaveButton() 
  } else {
    myFormCloseButton() 
  }
}

setInputValueOnClick();
// ================
</script>
</body>
</html>
