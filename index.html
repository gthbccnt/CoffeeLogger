<!DOCTYPE html>
<html>
  <meta name="apple-mobile-web-app-title" content="CoffeeLogger">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#D1B888">
  <meta name="viewport" content="width=device-width">
  <link rel="apple-touch-icon" href="icon.png">
  <head>
  <style>
* {
    box-sizing: border-box;
    font-family: system-ui, iconMode;
}

body {
  margin:0;
  background-color: #D1B888;
  background: linear-gradient(0deg, rgba(222,179,103,.8) 0%, rgba(209,184,136,1) 90%);
  touch-action: none;
  background-attachment: fixed;
  height: 100vh;
  width: 100vw;
  overflow:hidden;
}

#appTitle {
  margin-left: 4vw;
  margin-top: 0vw;
  font-size: 10vw;
}

.grinders {
  font-weight: light;
  font-size: 5vw;
  text-align: right;
	left: 5vw;
}

#headerButtonContainer {
  display: flex;
  position: fixed;
  top: 5.2vw;
  right: 0vw;
}

#exportButton {
	display: none;
  z-index: 0;
	height: 12vw;
	max-width: 20vw;
  min-width: 12vw;
	/*position: fixed;
	right: 16vw;*/
  padding: 0;
  font-size: 3vw; /* 7vw */
  top: 0vw;
  box-shadow: 0px 0px 10px -2px #00000020;
}

#menuButton {
  z-index: 0;
  padding: 0vw;
  /*position: fixed;
  right: 0.5vw;*/
  font-size: 3vw;
  height: 12vw;
  max-width:18vw;
  min-width: 12vw;
  box-shadow: 0px 0px 10px -2px #00000020;
}

::-webkit-scrollbar {
  display: none; /* Safari and Chrome */
}

#roundedCorners1, #roundedCorners2 {
  border: none;
  border-radius: 15px;
  overflow: scroll;
  width: 96%;
  max-height: 69.5vw;
  margin-right: 2%;
  margin-left: 2%;
  margin-bottom: 3vw;
  box-shadow: 0px 0px 12px -2px #00000020;
  overscroll-behavior: none;
}

#roundedCorners1 {
  max-height: 85vw;
  position: fixed;
  top: 19vw;
}

#roundedCorners2 {
  position: fixed;
  max-height: 75vw;
  top: 114vw;;
}

 #grinder1Title {
  position: fixed;
  top: 12vw;
 }
 #grinder2Title {
  position: fixed;
  top: 107vw;
 }

table {
  border-collapse: collapse;
  width: 100%;
  text-align: center;
}

thead tr {
  position: sticky;
  top: 0;
  background-color: #ffffff75;
  font-size: 3vw;
  border: none;
  -webkit-backdrop-filter: blur(55px);
  backdrop-filter: blur(55px);
  height: 12vw;
}

#tableHead1, #tableHead2 { 
  filter: drop-shadow(0px 0px 2px #00000040);
}

tbody {
/*  font-weight: light;*/
  font-size: 3.5vw;
}
td {
    border: none;
    height: 10.5vw;
}

tbody tr:nth-child(even) {
  background-color: #ffffff50;
}
tbody tr:nth-child(odd) {
  background-color: #ffffff30;
}
tbody td:nth-child(-n+2) {
  font-size: 3vw;
}
.dark-theme {
  background-color: #353935;
  background: linear-gradient(0deg, #192124 0%, #2b2e30 100%);
/*   background: linear-gradient(0deg, #121212 0%, #1c1f21 100%);*/
  color: #ffffff99;/*#b5b4b2ee;*/
}

.dark-theme tbody tr:nth-child(even) {
    background-color: #ffffff09;
}
.dark-theme tbody tr:nth-child(odd) {
  background-color: #ffffff03;
}
.dark-theme thead tr {
    background-color: #42494930;
}

.dark-theme thead tr td{
    color: #ffffff90;
}

.dark-theme button,
.dark-theme #resetButton {
  background-color: #00000025;
  color: #000000;
}

.dark-theme #addBrew, .dark-theme #menuButton, .dark-theme #exportButton {
  background-color: #ffffff20;
}

.dark-theme #addBrew {
  box-shadow: 0px 0px 60px 30px #00000025;
}

.dark-theme #roundedCorners1, .dark-theme #roundedCorners2 {
  box-shadow: 0px 0px 12px -2px #00000020;
}

.dark-theme #logDetails,
.dark-theme #idTime,
.dark-theme #formInput1,
.dark-theme #formInput2,
.dark-theme #formInput3,
.dark-theme #selectList,
.dark-theme #editingInput,
.dark-theme input {
  background-color: #00000030;
  color: #A9A9A987;
}

.dark-theme #selectList {
  color: #000000bb;
}
.dark-theme .form-container, .dark-theme #popup, .dark-theme #editingContainer {
   background-color: #ffffff20; /*#d2b48c30;*/
   -webkit-backdrop-filter: blur(20px);
   backdrop-filter: blur(20px);
}
.dark-theme .form-popup, .dark-theme #popupBackground, .dark-theme #rating-popup {
  background-color: #ffffff00;
}
.dark-theme #logDetails:focus,
.dark-theme #idTime:focus,
.dark-theme #selectList:focus,
.dark-theme #formInput1:focus,
.dark-theme #formInput2:focus,
.dark-theme #formInput3:focus {
  -webkit-backdrop-filter: blur(35px);
  background-color: #00000050;
  outline: none;
}
.dark-theme #title {
  font-weight: bold;
  color: #000000;
}

.dark-theme #grinder1Title, .dark-theme #grinder2Title, .dark-theme #appTitle {
  color: #ebebeb87;
}

.dark-theme #inputIcon {
  color: #000000;
}

.dark-theme #rating-container {
  background-color: #ffffff10; /*#d2b48c30;*/
  -webkit-backdrop-filter: blur(45px);
  box-shadow: 0px 0px 100px 30px #00000020;
}

.dark-theme #ratingCancelButton {
   background-color: #ffffff10; /*#d2b48c30;*/
   -webkit-backdrop-filter: blur(20px);
   color: black;
}

.dark-theme #rating-item {
  color: #000000;
  background-color: #ffffff10;
}
.dark-theme ::placeholder {
  color: #000000;
}

.dark-theme #editingContainer {
    box-shadow: 0px 0px 45px 30px #00000025;
    background-color: #ffffff15;
}

button {
  font-size: 5.5vw;
  padding:1.5vw;
  min-width: 18vw;
  color: black;
  border: none;
  border-radius: 10px;
  text-align: center;
  margin-right: 2vw;
  background-color: #ffffff50;
  -webkit-backdrop-filter: blur(55px);
  backdrop-filter: blur(55px);
}

#resetButton {
  margin-left: auto;
  height: 13vw;
  min-width: 20vw;
  padding: 0;
  text-align: center;
  font-size: 5.5vw;
  color: black;
  background-color: #ffffff50;
  -webkit-backdrop-filter: blur(55px);
  backdrop-filter: blur(55px);
  border: none;
  border-radius: 10px;
}

#closeButton {
  margin-left: 3vw;
  margin-right: 0vw;
  height: 13vw;
  min-width: 20vw;
}

#addBrew {
  position: fixed;
  z-index: 1;
  background-color: #ffffff30;
  max-width:18vw;
  min-width: 15vw;
  min-height: 13vw;
  bottom: 10vh;
  right: 3vw;
  padding: 0;
  box-shadow: 0px 0px 60px 30px #00000020;
}

input, select {
  padding-left: 4vw;
  min-width: 18vw;
}

::placeholder {
  color: #00000090; 
  font-size: 5vw;
  opacity: 0.55;
}

.form-popup, #popupBackground, #rating-popup {
  display: none;
  position: fixed;
  z-index: 1;
  top: 0px;
  left: 0px;
  padding: 0;
  border: none;
  background-color: #ffffff00;
  -webkit-backdrop-filter: blur(15px);
  backdrop-filter: blur(15px);
  width: 100vw;
  height:100vh;
}

/* Add styles to the form container */
.form-container, #popup, #editingContainer {
 width: 89.6vw;
 left: 5vw;
 top: 25vw;
 position: fixed;
 background-color: #00000025;
 -webkit-backdrop-filter: blur(45px);
 backdrop-filter: blur(45px);
 border-radius: 20px;
 padding: 4vw;
}

#title {
  font-size: 10vw;
  font-weight: bold;
  margin-left: 1vw;
}
/* input fields()*/ 
#logDetails,
#idTime,
#selectList,
#formInput1,
#formInput2,
#formInput3,
#editingInput {
  width: 70vw;
  height: 14vw;
  border: none;
  border-radius: 10px;
  background-color: #ffffff50;
  font-size: 5vw;
  color: black;
  margin-left: auto;
  outline: none;
}

#selectList {
  appearance: none;
}
/* When the inputs get focus, do something */
#logDetails:focus,
#idTime:focus,
#selectList:focus {
  -webkit-backdrop-filter: blur(35px);
  background-color: #ffffff85;
  outline: none;
}

#menu-form button {
  padding: 5pt;
  width: 30.7%;
  margin: 0;
  height: 14vw;
}

#menu-form input {
  width: 100%;
  margin-bottom: 3.2%;
  text-align: left;
  padding-left: 4vw;
}

#menu-form input:focus {
  background-color: #ffffffaa;
}

#inputIcon {
  font-size: 8vw;
  display: flex;
  justify-content: center;
  align-items: center;
}

#firstRow, #secondRow, #thirdRow {
      vertical-align: middle;
      justify-content: space-evenly;
      display: flex;
      padding:0;
      margin-bottom: 3vw;
}
#buttonRow, #headRow {
  justify-content: space-between;
  display: flex;
}
#headRow {
  height: 15vw;
  margin-left: 0vw;
}

#popBtnContainer {
  display: flex;
  justify-content: space-between;
  width: 100%;
}

#popInpContainer {
  justify-content: space-evenly;
  margin-left: auto;
  margin-right: auto;
}

#rating-container {
  position: fixed;
  display: none;
  top: 20%;
  right: 21%;
  background-color: #00000020;
  border-radius: 15px;
  -webkit-backdrop-filter: blur(45px);
  box-shadow: 0px 0px 100px 40px #70707025;
}

#rating-container ul {
  justify-content: space-evenly;
  align-items: center;
  padding: 0;
  margin-top: 0vw;
  margin-bottom: 0vw;
}

#rating-item {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 15vw;
  height: 15vw;
  margin: 3vw;
  border-radius: 10px;
  -webkit-backdrop-filter: blur(25px);
  background-color: #ffffff60;
  color: black;
  font-family: system-ui;
  font-weight: 600;
  font-size: 9vw;
}

#ratingCancelButton {
  position: fixed;
  padding:0;
  top: -5vw;
  right: -5vw;
  display: flex;
  justify-content: center;
  background-color: #00000010;
  width: 10vw;
  height: 10vw;
  font-size: 8vw;
/*  box-shadow: 0px 0px 10px -5px;*/
  border-radius: 50%;
  -webkit-backdrop-filter: blur(25px);
}

.markDelete, .editingMode {
  background-color: #7F000090 !important;
  border-radius: 5px;
}

.dark-theme .markDelete, .dark-theme .editingMode {
  background-color: #ff000027 !important;
  border-radius: 5px;
}

#editingContainer {
  display: none;
  width: 58vw;
  padding: 3vw;
  position: fixed;
  top: 40vh;
  left: 21vw;
  box-shadow: 0px 0px 55px 40px #00000015;
  border-radius: 10px;
}

#editingContainer button {
  margin: 0;
  height: 14vw;
  border-radius: 10px;
  width: 24.3vw;
}

#editingButtonContainer {
  display: flex;
 justify-content: space-between;
}

#editingInput {
  width: 100%;
  height: 14vw;
  padding-left: 5%;
  margin-bottom: 3vw;
}

/* ======== ANIMATIONS ====== */
.spaceOutUp {
  animation: spaceOutUp 0.25s;
}
.spaceInUp {
  animation: spaceInUp 0.25s;
}

@keyframes spaceOutUp {
  0% {
    opacity: 1;
    -webkit-transform-origin: 50% 0%;
    transform-origin: 50% 0%;
    -webkit-transform: scale(1) translate(0%, 0%);
    transform: scale(1) translate(0%, 0%);
    -webkit-filter: blur(0);
    filter: blur(0);
  }

  100% {
    opacity: 0;
    -webkit-transform-origin: 50% 0%;
    transform-origin: 50% 0%;
    -webkit-transform: scale(0.2) translate(0%, -200%);
    transform: scale(0.2) translate(0%, -200%);
    -webkit-filter: blur(40px);
    filter: blur(40px);
  }
}

@keyframes spaceInUp {
  0% {
    opacity: 0;
    -webkit-transform-origin: 50% 0%;
    transform-origin: 50% 0%;
    -webkit-transform: scale(0.2) translate(0%, -200%);
    transform: scale(0.2) translate(0%, -200%);
    -webkit-filter: blur(40px);
    filter: blur(40px);
  }

  100% {
    opacity: 1;
    -webkit-transform-origin: 50% 0%;
    transform-origin: 50% 0%;
    -webkit-transform: scale(1) translate(0%, 0%);
    transform: scale(1) translate(0%, 0%);
    -webkit-filter: blur(0);
    filter: blur(0);
  }
}


/* ====== OLD ==== */
.fade-in {
  animation: fade-in 0.45s ease;
}
.fade-out {
  animation: fade-out 0.25s ease;
}

.slide-out-blurred-top {
animation: slide-out-blurred-top 0.25s cubic-bezier(0.755, 0.050, 0.855, 0.060) both;
}

.slide-in-blurred-top {
animation: slide-in-blurred-top 0.25s cubic-bezier(0.230, 1.000, 0.320, 1.000) both;
}

.slide-in-blurred-right {
  animation: slide-in-blurred-right 0.25s cubic-bezier(0.230, 1.000, 0.320, 1.000) both;
}

.slide-out-blurred-right {
  animation: slide-out-blurred-right 0.25s cubic-bezier(0.755, 0.050, 0.855, 0.060) both;
}

.slide-out-blurred-br {
animation: slide-out-blurred-br 0.25s cubic-bezier(0.755, 0.050, 0.855, 0.060) both;
}

.slide-in-blurred-br {
animation: slide-in-blurred-br 0.25s cubic-bezier(0.230, 1.000, 0.320, 1.000) both;
}

@keyframes slide-in-blurred-top {
  0% {
    -webkit-transform: translateY(-1000px) scaleY(2.5) scaleX(0.2);
            transform: translateY(-1000px) scaleY(2.5) scaleX(0.2);
    -webkit-transform-origin: 50% 0%;
            transform-origin: 50% 0%;
    -webkit-filter: blur(40px);
            filter: blur(40px);
    opacity: 0;
  }
  100% {
    -webkit-transform: translateY(0) scaleY(1) scaleX(1);
            transform: translateY(0) scaleY(1) scaleX(1);
    -webkit-transform-origin: 50% 50%;
            transform-origin: 50% 50%;
    -webkit-filter: blur(0);
            filter: blur(0);
    opacity: 1;
  }
}

@keyframes slide-out-blurred-top {
  0% {
    -webkit-transform: translateY(0) scaleY(1) scaleX(1);
            transform: translateY(0) scaleY(1) scaleX(1);
    -webkit-transform-origin: 50% 0%;
            transform-origin: 50% 0%;
    -webkit-filter: blur(0);
            filter: blur(0);
    opacity: 1;
  }
  100% {
    -webkit-transform: translateY(-1000px) scaleY(2) scaleX(0.2);
            transform: translateY(-1000px) scaleY(2) scaleX(0.2);
    -webkit-transform-origin: 50% 0%;
            transform-origin: 50% 0%;
    -webkit-filter: blur(40px);
            filter: blur(40px);
    opacity: 0;
  }
}

@keyframes slide-in-blurred-right {
  0% {
    -webkit-transform: translateX(1000px) scaleX(2.5) scaleY(0.2);
            transform: translateX(1000px) scaleX(2.5) scaleY(0.2);
    -webkit-transform-origin: 0% 50%;
            transform-origin: 0% 50%;
    -webkit-filter: blur(40px);
            filter: blur(40px);
    opacity: 0;
  }
  100% {
    -webkit-transform: translateX(0) scaleY(1) scaleX(1);
            transform: translateX(0) scaleY(1) scaleX(1);
    -webkit-transform-origin: 50% 50%;
            transform-origin: 50% 50%;
    -webkit-filter: blur(0);
            filter: blur(0);
    opacity: 1;
  }
}

@keyframes slide-out-blurred-right {
  0% {
    -webkit-transform: translateX(0) scaleY(1) scaleX(1);
            transform: translateX(0) scaleY(1) scaleX(1);
    -webkit-transform-origin: 50% 50%;
            transform-origin: 50% 50%;
    -webkit-filter: blur(0);
            filter: blur(0);
    opacity: 1;
  }
  100% {
    -webkit-transform: translateX(1000px) scaleX(2) scaleY(0.2);
            transform: translateX(1000px) scaleX(2) scaleY(0.2);
    -webkit-transform-origin: 0% 50%;
            transform-origin: 0% 50%;
    -webkit-filter: blur(40px);
            filter: blur(40px);
    opacity: 0;
  }
}

@keyframes slide-in-blurred-br {
  0% {
    -webkit-transform: translate(1000px, 1000px) skew(80deg, 10deg);
            transform: translate(1000px, 1000px) skew(80deg, 10deg);
    -webkit-transform-origin: 0% 100%;
            transform-origin: 0% 100%;
    -webkit-filter: blur(40px);
            filter: blur(40px);
    opacity: 0;
  }
  100% {
    -webkit-transform: translate(0, 0) skew(0deg, 0deg);
            transform: translate(0, 0) skew(0deg, 0deg);
    -webkit-transform-origin: 50% 50%;
            transform-origin: 50% 50%;
    -webkit-filter: blur(0);
            filter: blur(0);
    opacity: 1;
  }
}

@keyframes slide-out-blurred-br {
  0% {
    -webkit-transform: translate(0, 0) skew(0deg, 0deg);
            transform: translate(0, 0) skew(0deg, 0deg);
    -webkit-transform-origin: 50% 50%;
            transform-origin: 50% 50%;
    -webkit-filter: blur(0);
            filter: blur(0);
    opacity: 1;
  }
  100% {
    -webkit-transform: translate(1000px, 1000px) skew(80deg, 10deg);
            transform: translate(1000px, 1000px) skew(80deg, 10deg);
    -webkit-transform-origin: 0% 100%;
            transform-origin: 0% 100%;
    -webkit-filter: blur(40px);
            filter: blur(40px);
    opacity: 0;
  }
}

@keyframes fade-out {
  0% {
    opacity: 1;
  }
  100% {
    opacity: 0;
  }
}
@keyframes fade-in {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
  </style>
</head>
<body>
<h1 id="appTitle">Coffee Log</h1>
<div id="headerButtonContainer">
  <button id="exportButton" onclick="shareCSV()">Export</button>
  <button id="menuButton" onclick="showPopup()">Menu</button>
</div>
<div id="grinder1Title" class="grinders">Grinder 1</div>
<div id="roundedCorners1">
  <table id="grinder1">
    <thead id="tableHead1">
      <tr>
              <td>Date</td>
              <td>Time</td> 
              <td>Set.</td>
              <td>gr.</td> 
              <td>ml.</td>
              <td>&deg;C</td> 
              <td>Recipe</td>
              <td>Rating</td> 
              <td>Draw</td>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>
</div>

<!-- <button id="toggleB1" onclick="toggleTable1();toggleSlice1()">&#x100068;</button> -->
<button id="addBrew" onclick="openForm()">Add</button>

<div class="grinders" id="grinder2Title">Grinder 2</div>
<div id="roundedCorners2">
  <table id="grinder2">
    <thead id="tableHead2">
      <tr>
               <td>Date</td>
              <td>Time</td> 
              <td>Set.</td>
              <td>gr.</td> 
              <td>ml.</td>
              <td>&deg;C</td> 
              <td>Recipe</td>
              <td>Rating</td> 
              <td>Draw</td>
      </tr>
    </thead>
      <tbody>
    </tbody>
  </table>
</div>

<!-- <button id="toggleB2" onclick="toggleTable2();toggleSlice2()">&#x100068;</button> -->

<div id="popupBackground">
  <div id="popup">
    <form id="menu-form">
      <div id="popInpContainer">
        <input type="text" placeholder="First Grinder" name="firstGrinder" id="formInput1">
          <input type="text" placeholder="Second Grinder" name="secondGrinder" id="formInput2">
        <input type="text" placeholder="Enter IFTTT Key" name="iftttKey" id="formInput3">
      </div>
      <div id=popBtnContainer>
        <button onclick="clearLocalStorage(); reloadPage()" id="csvBtn">Wipe</button>
        <button onclick="openCsvOrFont()" id="fontBtn">Add File</button>
        <button type="submit" id="saveButton">Save</button>
      </div>
    </form>
  </div>
</div>
 
<div class="form-popup" id="myForm">
  <form action="/action_page.php" class="form-container" autocomplete="off" novalidate>
    <div id="headRow">
      <div id=title>Log Brew</div>
    </div>
    <div id="firstRow">
      <div id="inputIcon">S.</div>
      <input type="text" autocorrect="off" autocapitalize="off" placeholder="Enter measurements" name="log" id="logDetails">
    </div>
    <div id="secondRow">
      <div id="inputIcon">R.</div>
      <select name="recipe" id="selectList" required>
        <optgroup label="Inverted">
          <option value="TWi">Wendelboe inverted</option>
          <option value="JHi">Hoffmann inverted</option>
          <option value="OXi">Onyx inverted</option>
        </optgroup>
        <optgroup label="Aeropress">
          <option value="JH">James Hoffmann</option>
          <option value="TW" selected="selected">Tim Wendelboe</option>
          <option value="OX">Onyx Coffee</option>
          <option value="AO">Aeropress Original</option>
        </optgroup>
        <optgroup label="V60">
          <option value="TK">Tetsu Kasuya 4:6</option>
          <option value="OX">Onyx Coffee</option>
          <option value="JH">James Hoffmann</option>
        </optgroup>
        <optgroup label="Moka Pot">
          <option value="MK">James Hoffmann</option>
        </optgroup>
      </select>
    </div>
    <div id="thirdRow">
      <div id="inputIcon">T.</div>
      <input type="number" placeholder="Enter time" name="time" id="idTime">
    </div>
    <div id=buttonRow>
      <input type=reset value="Reset" id="resetButton"></input>
      <button type="button" onclick="closeForm();closeFormEval()" id="closeButton">Close</button>
    </div>
    </form>
  </div>
<!-- <div id="rating-popup"> -->
  <div id="rating-container">
        <li id="ratingCancelButton">X</li>
    <ul id="rating-list">
      <li id="rating-item">1</li>
      <li id="rating-item">2</li>
      <li id="rating-item">3</li>
      <li id="rating-item">4</li>
      <li id="rating-item">5</li>
      <li id="rating-item">6</li>
    </ul>
  </div>
<!-- </div> -->

<div id='editingContainer'>
  <input id='editingInput'><br>
  <div id="editingButtonContainer">
    <button id='editingSave'>Save</button>
    <button id='editingCancel'>Cancel</button>
  </div>
</div>
  
<script>
if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('/service-worker.js').then(function(registration) {
        // Registration was successful
        console.log('ServiceWorker registration successful with scope: ', registration.scope);
      }, function(err) {
        // Registration failed
        console.log('ServiceWorker registration failed: ', err);
      });
    });
  }

    window.addEventListener('beforeunload', () => {
    saveDataToLocalStorage("#grinder1 tbody tr", "coffeeLog1");
    saveDataToLocalStorage("#grinder2 tbody tr", "coffeeLog2");
});

document.addEventListener('visibilitychange', () => {
  if (document.visibilityState === 'hidden') {
    saveDataToLocalStorage("#grinder1 tbody tr", "coffeeLog1");
    saveDataToLocalStorage("#grinder2 tbody tr", "coffeeLog2");
  }
});

function saveDataToLocalStorage(userGrinder, userLog) {
  const rows = document.querySelectorAll(userGrinder);
  const data = [];
  rows.forEach((row) => {
    const cells = row.querySelectorAll('td');
    const rowData = {
      date: cells[0].innerHTML,
      time: cells[1].innerHTML,
      setting: cells[2].innerHTML,
      gr: cells[3].innerHTML,
      ml: cells[4].innerHTML,
      degrees: cells[5].innerHTML,
      recipe: cells[6].innerHTML,
      rating: cells[7].innerHTML,
      drawdown: cells[8].innerHTML,
    };
    data.push(rowData);
  });
  localStorage.setItem(userLog, JSON.stringify(data));
}


function loadSelectedFont() {
  const fontData = localStorage.getItem('selectedFont');
  if (fontData) {
    const tableHeaders = document.querySelectorAll('thead tr td');
    const tableHeaderFontsize1 = document.querySelector('#grinder1 thead tr');
    const tableHeaderFontsize2 = document.querySelector('#grinder2 thead tr');
    const tableHeaders2 = document.querySelectorAll('#grinder2 thead tr td');
tableHeaderFontsize1.style.fontSize = '5vw'; 
tableHeaderFontsize2.style.fontSize = '5vw'; 

tableHeaders[0].textContent = '\u{100249}';
tableHeaders[1].textContent = '\u{10042b}';
tableHeaders[2].textContent = '\u{1007f2}';
tableHeaders[3].textContent = '\u{100b6d}';
tableHeaders[4].textContent = '\u{101384}';
tableHeaders[5].textContent = '\u{1001ec}';
tableHeaders[6].textContent = '\u{10155c}';
tableHeaders[7].textContent = '\u{1002c4}';
tableHeaders[8].textContent = '\u{10042f}';
tableHeaders2[0].textContent = '\u{100249}';
tableHeaders2[1].textContent = '\u{10042b}';
tableHeaders2[2].textContent = '\u{1013b4}';
tableHeaders2[3].textContent = '\u{100b6d}';
tableHeaders2[4].textContent = '\u{101384}';
tableHeaders2[5].textContent = '\u{1001ec}';
tableHeaders2[6].textContent = '\u{10155c}';
tableHeaders2[7].textContent = '\u{1002c4}';
tableHeaders2[8].textContent = '\u{10042f}';
  
const menuButtonIcon = document.querySelector('#menuButton')
  menuButtonIcon.textContent = '\u{100306}';
  menuButtonIcon.style.fontSize = "7vw";

const addButtonIcon = document.querySelector('#addBrew')
  addButtonIcon.textContent = '\u{10004c}'
  addButtonIcon.style.fontSize = '12vw';
  addButtonIcon.style.height = '15vw';
  addButtonIcon.style.width = '15vw';
  addButtonIcon.style.borderRadius = '50%';
  
const cancelButtonIcon = document.querySelector('#ratingCancelButton')
  cancelButtonIcon.textContent = '\u{100060}'



const resetButtonIcon = document.querySelector('#resetButton')
  resetButtonIcon.textContent = '\u{100060}';
  
const inputIcons = document.querySelectorAll('#inputIcon')
    inputIcons[0].textContent ='\u{1007f2}';
    inputIcons[1].textContent ='\u{10155c}';
    inputIcons[2].textContent ='\u{10042f}';
    
const exportButtonIcon = document.querySelector("#exportButton")
  exportButtonIcon.textContent = "\u{100202}"
  exportButtonIcon.style.fontSize = "6vw";

const css = `@font-face {
      font-family: 'iconMode';
      src: url('data:font/opentype;charset=utf-8;base64,${fontData}');
      font-display: swap;
    }`;
const style = document.createElement('style');
style.appendChild(document.createTextNode(css));
    document.head.appendChild(style);
  }
}

window.addEventListener('load', () => {
  loadSelectedFont()

  window.setTimeout(() => {

    loadLogs('coffeeLog1', '#grinder1 tbody');
    loadLogs('coffeeLog2', '#grinder2 tbody');
    showExportButton()

    const grinderTitle1 = localStorage.getItem('grinderName1')
    if (grinderTitle1) {
      document.querySelector('#grinder1Title').textContent = grinderTitle1
      document.querySelector('#formInput1').setAttribute('placeholder', 'Current: ' + grinderTitle1)
    }
    const grinderTitle2 = localStorage.getItem('grinderName2')
    if (grinderTitle2) {
      document.querySelector('#grinder2Title').textContent = grinderTitle2
      document.querySelector('#formInput2').setAttribute('placeholder', 'Current: ' + grinderTitle2)
    }
    const storedIftttKey = localStorage.getItem('iftttKey')
    if (storedIftttKey){
      const popupIftttInput = document.getElementById('formInput3')
      popupIftttInput.setAttribute('placeholder', 'IFTTT Key found!')
    }
  }, 10);
});


function loadLogs(userGrinder, selectedTable) {
  const data = JSON.parse(localStorage.getItem(userGrinder));
  const tableBody = document.querySelector(selectedTable);
  if (data) {
    // iterate through the data array from beginning to end
    for (let i = 0; i < data.length; i++) {
      const row = data[i];
      const tableRow = document.createElement('tr');
      const dateCell = document.createElement('td');
      dateCell.textContent = row.date;
      dateCell.setAttribute('data-row', i+1);
      dateCell.setAttribute('data-col', 1);
      dateCell.onclick = function() {
      deleteRow(this);
      };
      const timeCell = document.createElement('td');
      timeCell.textContent = row.time;
      timeCell.setAttribute('data-row', i+1);
      timeCell.setAttribute('data-col', 2);
      
      const setCell = document.createElement('td');
      setCell.textContent = row.setting;
      setCell.onclick = function() {
      editTableCell(this, 'setCell' + i); // add unique ID to setCell
      };
      setCell.setAttribute('data-row', i+1);
      setCell.setAttribute('data-col', 3);
      
      const grCell = document.createElement('td');
      grCell.textContent = row.gr;
      grCell.onclick = function() {
      editTableCell(this, 'grCell' + i); // add unique ID to setCell
      };
      grCell.setAttribute('data-row', i+1);
      grCell.setAttribute('data-col', 4);
      
      const mlCell = document.createElement('td');
      mlCell.textContent = row.ml;
      mlCell.onclick = function() {
      editTableCell(this, 'mlCell' + i); // add unique ID to setCell
      };
      mlCell.setAttribute('data-row', i+1);
      mlCell.setAttribute('data-col', 5);
      
      const degCell = document.createElement('td');
      degCell.textContent = row.degrees;
      degCell.onclick = function() {
      editTableCell(this, 'degCell' + i); // add unique ID to setCell
      };
      degCell.setAttribute('data-row', i+1);
      degCell.setAttribute('data-col', 6);
      
      const recCell = document.createElement('td');
      recCell.textContent = row.recipe;
      recCell.onclick = function() {
      editTableCell(this, 'recCell' + i); // add unique ID to setCell
      };
      recCell.setAttribute('data-row', i+1);
      recCell.setAttribute('data-col', 7);
      
      const ratCell = document.createElement('td');
      ratCell.textContent = row.rating;
      ratCell.setAttribute('data-row', i+1);
      ratCell.setAttribute('data-col', 8);
      ratCell.classList.add('rating-cell');
      
      const drawCell = document.createElement('td');
      drawCell.textContent = row.drawdown;
      drawCell.onclick = function() {
      editTableCell(this, 'drawCell' + i); // add unique ID to setCell
      };
      drawCell.setAttribute('data-row', i+1);
      drawCell.setAttribute('data-col', 9);
      tableRow.appendChild(dateCell);
      tableRow.appendChild(timeCell);
      tableRow.appendChild(setCell);
      tableRow.appendChild(grCell);
      tableRow.appendChild(mlCell);
      tableRow.appendChild(degCell);
      tableRow.appendChild(recCell);
      tableRow.appendChild(ratCell);
      tableRow.appendChild(drawCell);
      tableBody.appendChild(tableRow);//, tableBody.firstChild); // use appendChild instead of insertBefore
    }
  }
}

function deleteRow(cell) {
  const row = cell.parentNode;
  row.classList.add('markDelete');
  setTimeout(() => {
  const confirmDelete = confirm('Delete this brew log?');
  if (confirmDelete) {
    row.parentNode.removeChild(row);
  } else {
    row.classList.remove('markDelete');
  }
  }, 100);
}
    
const bodyDarkMode = document.querySelector('body');
  var metaTag = document.querySelector('meta[name="theme-color"]');

// Check if the system's color scheme is light or dark
  if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
    bodyDarkMode.classList.add('dark-theme');
    metaTag.setAttribute('content', '#2b2e30');// add value for popup
  } else {
    metaTag.setAttribute('content', '#D1B888')
    bodyDarkMode.classList.remove('dark-theme');
  }

// Add a listener to toggle the theme when the system's color scheme changes
window.matchMedia('(prefers-color-scheme: dark)').addListener((event) => {
  if (event.matches) {
    bodyDarkMode.classList.add('dark-theme');
    metaTag.setAttribute('content', '#2b2e30');// add value for popup
  } else {
    metaTag.setAttribute('content', '#D1B888')
    bodyDarkMode.classList.remove('dark-theme');
  }
})

// ===== Add brew form

const formPopup = document.getElementById("myForm")
const formContainer = formPopup.querySelector(".form-container");
const menuButtonTemp = document.querySelector('#menuButton')
const tempExportButton = document.querySelector('#exportButton')
const appTitle = document.querySelector('#appTitle')

function openForm() {
  formContainer.classList.add("slide-in-blurred-br");
  formPopup.classList.add("fade-in")
  formPopup.style.display = "block";
  menuButtonTemp.style.display = 'none'
  tempExportButton.style.display = 'none'
  appTitle.style.display = 'none'
  setTimeout(function() {
    formContainer.classList.remove("slide-in-blurred-br");
    formPopup.classList.remove("fade-in");
  }, 300);
}

function closeForm() {
  formContainer.classList.add("slide-out-blurred-br");
  formPopup.classList.add("fade-out");
  menuButtonTemp.style.display = 'block'
  tempExportButton.style.display = 'block'
  appTitle.style.display = 'block'
  setTimeout(function() {
    formPopup.style.display = "none";
    formContainer.classList.remove("slide-out-blurred-br");
    formPopup.classList.remove("fade-out");
  }, 250);
}

function closeFormEval() {
  const tbody1 = document.querySelector("#grinder1 tbody");
  const tbody2 = document.querySelector("#grinder2 tbody");
  const currentDate = new Date().toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: '2-digit' });
  const currentTime = new Date().toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
  const logInput = document.getElementById("logDetails").value
  const logCells = logInput.replaceAll("-",";").split(";");
  const selectList = document.getElementById("selectList").value;
  const idTime = document.getElementById("idTime").value.replace(".", ":");
  let tr;
  let rows;
  if (logInput.length>0) {
    if (logInput.includes(".")){
      tr = tbody1.insertRow(0);
      rows = tbody1.rows;
    } else {
      tr = tbody2.insertRow(0); 
      rows = tbody2.rows;
    }
    const cells = [currentDate, currentTime, logCells[0], logCells[1], logCells[2], logCells[3], selectList, "3", idTime];
    cells.forEach((cell, cellIndex) => {
      const td = tr.insertCell();
      td.textContent = cell;
      if (cellIndex === 7) {
        td.classList.add('rating-cell');
        td.addEventListener('click', function() {
          const ratingPopup = document.querySelector('#rating-popup');
          ratingPopup.style.display = 'flex';
          this.classList.add('selected-cell');
        });
      }
      td.setAttribute('data-row', 0);
      td.setAttribute('data-col', cellIndex);
    });
    // adjust data-row and data-col for all cells in table body
    for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {
      const cells = rows[rowIndex].cells;
      for (let cellIndex = 0; cellIndex < cells.length; cellIndex++) {
        const cell = cells[cellIndex];
        cell.setAttribute('data-row', rowIndex);
        cell.setAttribute('data-col', cellIndex);
      }
    }
  }
}
// ====== END brew form
// ===== RATING =====
setTimeout(() => {
const ratingCells = document.querySelectorAll('.rating-cell');
const ratingPopup = document.getElementById('rating-popup');
const ratingContainer = document.getElementById('rating-container');
const ratingItems = document.querySelectorAll('#rating-list li');
const cancelButton = document.getElementById('ratingCancelButton');

ratingCells.forEach(cell => {
  cell.addEventListener('click', function() {
    //ratingPopup.classList.add('fade-in'); 
    ratingContainer.classList.add('slide-in-blurred-right'); 
    const row = this.getAttribute('data-row');
    const col = this.getAttribute('data-col');
    const cellRect = this.getBoundingClientRect();

    ratingContainer.style.display = 'flex';
    ratingContainer.classList.add('active');
    this.classList.add('selected-cell');
    this.classList.add('editingMode');
  });
});

ratingItems.forEach(item => {
  item.addEventListener('click', function() {
    const selectedRating = this.innerText;
    const selectedCell = document.querySelector('.selected-cell');
    selectedCell.innerText = selectedRating;
    selectedCell.classList.remove('editingMode');
    selectedCell.classList.remove('selected-cell');
    //ratingPopup.classList.replace('fade-in', 'fade-out'); 
    ratingContainer.classList.replace('slide-in-blurred-right', 'slide-out-blurred-right'); 
    setTimeout(() => {
      ratingContainer.style.display = 'none';
      //ratingPopup.classList.replace('fade-out', 'fade-in');
      ratingContainer.classList.replace('slide-out-blurred-right', 'slide-in-blurred-right');
    }, 250);
  });
});

cancelButton.addEventListener('click', function() {
  const selectedCell = document.querySelector('.selected-cell');
  selectedCell.classList.remove('editingMode');
  selectedCell.classList.remove('selected-cell');
  //ratingPopup.classList.replace('fade-in', 'fade-out');
  ratingContainer.classList.replace('slide-in-blurred-right', 'slide-out-blurred-right'); 
  setTimeout(() => {
    ratingContainer.style.display = 'none';
    //ratingPopup.classList.replace('fade-out', 'fade-in'); 
    ratingContainer.classList.replace('slide-out-blurred-right', 'slide-in-blurred-right');
  }, 250);
});
}, 100);
// ====== END RATING =====
// ========= popup =====
function showPopup() {
  const backgroundPopup = document.body.querySelector('#popupBackground')
  const popup = document.body.querySelector('#popup')

  backgroundPopup.classList.add('fade-in');
  popup.classList.add('slide-in-blurred-top');
  menuButtonTemp.style.display = 'none'
  tempExportButton.style.display = 'none'
  appTitle.style.display = 'none'
  backgroundPopup.style.display= 'block';
  popup.style.display= 'block';
  
  const form = document.getElementById('menu-form');
  form.addEventListener('submit', (event) => {
    event.preventDefault();
    const setGrinder1 = document.querySelector('[name="firstGrinder"]');
    if (setGrinder1.value!==""){
    localStorage.setItem('grinderName1',setGrinder1.value);
    }
    
    const setGrinder2 = document.querySelector('[name="secondGrinder"]');
    if (setGrinder2.value!==""){
    localStorage.setItem('grinderName2',setGrinder2.value);
    }
    const setIftttKey = document.querySelector('[name="iftttKey"]');
    if (setIftttKey.value!==""){
    localStorage.setItem('iftttKey', setIftttKey.value);
    }

    backgroundPopup.classList.remove('fade-in');
    popup.classList.remove('slide-in-blurred-top');

    backgroundPopup.classList.add('fade-out');
    popup.classList.add('slide-out-blurred-top');
    menuButtonTemp.style.display = 'block'
    tempExportButton.style.display = 'block'
    appTitle.style.display = 'block'
    setTimeout(() => {
      backgroundPopup.classList.remove('fade-out');
      popup.classList.remove('slide-out-blurred-top');
      backgroundPopup.style.display= 'none';
      popup.style.display= 'none';
    }, 200);
  });
}

function reloadPage() {
  setTimeout(() => {
    location.reload();
  }, 200)
}

// function openCsvOrFont() {
//   const fileInput = document.createElement('input');
//   fileInput.type = 'file';
//   fileInput.accept = '.csv,.ttf,.otf';
//   fileInput.onchange = () => {
//     const file = fileInput.files[0];
//     const reader = new FileReader();
//     reader.onload = () => {
//       const fileData = reader.result;
//       if (file.type === 'text/csv') {
//         console.log(file.name)
//         addCsvToTable(fileData, file.name);
//         reloadPage();
//       } else if (file.type === 'font/ttf' || file.type === 'font/otf') {
//         const reader = new FileReader();
//         reader.onload = () => {
//           const fontData = reader.result.split(',')[1];
//           try {
//             localStorage.setItem('selectedFont', fontData);
//             alert('Selected font saved to local storage!');
//             reloadPage();
//           } catch (e) {
//             alert('Error saving font to local storage: ' + e.message);
//           }
//         };
//         reader.readAsDataURL(file);
//       }
//     };
//     reader.readAsText(file);
//   };
//   fileInput.click();
// }

function openCsvOrFont() {
  const fileInput = document.createElement('input');
  fileInput.type = 'file';
  fileInput.accept = '.csv,.ttf,.otf,.json';
  fileInput.onchange = () => {
    const file = fileInput.files[0];
    const reader = new FileReader();
    reader.onload = () => {
      const fileData = reader.result;
      if (file.type === 'text/csv') {
        console.log(file.name)
        addCsvToTable(fileData, file.name);
        reloadPage();
      } else if (file.type === 'font/ttf' || file.type === 'font/otf') {
        const reader = new FileReader();
        reader.onload = () => {
          const fontData = reader.result.split(',')[1];
          try {
            localStorage.setItem('selectedFont', fontData);
            alert('Selected font saved to local storage!');
            reloadPage();
          } catch (e) {
            alert('Error saving font to local storage: ' + e.message);
          }
        };
        reader.readAsDataURL(file);
      } else if (file.type === 'application/json') {
        try {
          const json = JSON.parse(fileData);
          localStorage.setItem('google_json_key', JSON.stringify(json));
          alert('Google JSON key saved to local storage!');
          reloadPage();
        } catch (e) {
          alert('Error saving Google JSON key to local storage: ' + e.message);
        }
      }
    };
    reader.readAsText(file);
  };
  fileInput.click();
}


function addCsvToTable(csvData, fileName) {
  const fileNameString = fileName;
  let tbodyTemp = document.querySelector('#grinder1 tbody');
  if (fileNameString.includes("C2")===true) {
    tbodyTemp = document.querySelector('#grinder2 tbody');
  }
  console.log(tbodyTemp)
  const rows = csvData.split('\n').map(row => row.split(';'));
  rows.slice(0).forEach((row, rowIndex) => {
    const tr = tbodyTemp.insertRow();
    row.forEach((cell, cellIndex) => {
      const td = tr.insertCell();
      td.textContent = cell;
    });
  });
}


function checkStoredLog() {
  if (!localStorage.getItem('coffeeLog1')) {
    setTimeout(() => {
      showPopup();
      }, 250);
  }
}

checkStoredLog()

// function sendPostRequest(value, apiKey) {
 // const script = document.createElement('script');
 // const url = 'https://maker.ifttt.com/trigger/coffeeLogBackup/with/key/' + apiKey;
 // script.src = `${url}?value1=${encodeURIComponent(value)}`;
 // document.body.appendChild(script);
//}

function clearLocalStorage() {
  localStorage.clear();
  const tbody1 = document.querySelector('#grinder1 tbody');
  const tbody2 = document.querySelector('#grinder2 tbody');
  tbody1.innerHTML = '';
  tbody2.innerHTML = '';
}

function editTableCell(cell) {
  cell.classList.add('editingMode');
  const editingContainer = document.querySelector('#editingContainer');
  editingContainer.classList.add('spaceInUp');

  const cellRect = cell.getBoundingClientRect();
  const topOffset = cellRect.top + cellRect.height + window.pageYOffset + 5; // add 1vw

  // Check if the cell's bottom is above or below the middle of the viewport
  const isAboveMiddle = (cellRect.bottom < window.innerHeight / 2);

  if (isAboveMiddle) {
    editingContainer.style.top = `${topOffset}px`;
    editingContainer.style.zIndex = '1';
  } else {
    const editingContainerHeight = editingContainer.offsetHeight;
    const topOffset = cellRect.top - 5 - 138; // subtract 5vw
    editingContainer.style.top = `${topOffset - editingContainerHeight}px`;
    editingContainer.style.zIndex = '2';
  }

  editingContainer.style.display = 'block';
  const editingInput = document.querySelector('#editingInput');
  editingInput.value = cell.textContent;
  const saveButton = document.querySelector('#editingSave');
  const cancelButton = document.querySelector('#editingCancel');

  function onSaveClick() {
    cell.textContent = editingInput.value;
    editingContainer.classList.remove('spaceInUp');
    editingContainer.classList.add('spaceOutUp');
    cell.classList.remove('editingMode');
    setTimeout(() => {
      editingContainer.style.display = 'none'
      saveButton.removeEventListener('click', onSaveClick);
      cancelButton.removeEventListener('click', onCancelClick);
    }, 240); 
  }
  function onCancelClick() {
    editingContainer.classList.remove('spaceInUp');
    editingContainer.classList.add('spaceOutUp');
    cell.classList.remove('editingMode');
    setTimeout(() => {
      editingContainer.style.display = 'none'
      saveButton.removeEventListener('click', onSaveClick);
      cancelButton.removeEventListener('click', onCancelClick);
    }, 240); 
  }
  saveButton.addEventListener('click', onSaveClick);
  cancelButton.addEventListener('click', onCancelClick);
}

// ===== export as csv every three days
const lastBackupStr = localStorage.getItem('lastBackup');
const lastBackupDate = new Date(lastBackupStr);
const currentDate = new Date();

function shareCSV() {
  const grinder1Tbody = document.querySelector('#grinder1 tbody');
  const grinder2Tbody = document.querySelector('#grinder2 tbody');
  const hasGrinder1Data = grinder1Tbody && grinder1Tbody.querySelectorAll('td').length;
  const hasGrinder2Data = grinder2Tbody && grinder2Tbody.querySelectorAll('td').length;
  if (!hasGrinder1Data && !hasGrinder2Data) {
    return;
  }
  const grinder1Rows = hasGrinder1Data ? Array.from(grinder1Tbody.querySelectorAll('tr'))
    .map(row => Array.from(row.querySelectorAll('td'))
      .map(cell => cell.textContent.replace(/;/g, '\;'))
      .join(';')
    ) : [];
  const grinder2Rows = hasGrinder2Data ? Array.from(grinder2Tbody.querySelectorAll('tr'))
    .map(row => Array.from(row.querySelectorAll('td'))
      .map(cell => cell.textContent.replace(/;/g, '\;'))
      .join(';')
    ) : [];
  const grinder1CSVStr = grinder1Rows.join('\n');
  const grinder2CSVStr = grinder2Rows.join('\n');
  const grinder1FileName = `${localStorage.getItem('grinderName1')} ${currentDate.toLocaleDateString('de-DE')}_backup.csv`;
  const grinder2FileName = `${localStorage.getItem('grinderName2')} ${currentDate.toLocaleDateString('de-DE')}_backup.csv`;
  const shareData = {
    files: []
  };
  if (hasGrinder1Data) {
    const grinder1File = new File([grinder1CSVStr], grinder1FileName, {type: 'text/csv'});
    shareData.files.push(grinder1File);
  }
  if (hasGrinder2Data) {
    const grinder2File = new File([grinder2CSVStr], grinder2FileName, {type: 'text/csv'});
    shareData.files.push(grinder2File);
  }
  //setTimeout(() => {
   navigator.share(shareData)
//}, 100)
    .then(() => {
      const grinder1ExportButton = document.querySelector("#grinder1 #exportButton");
      const grinder2ExportButton = document.querySelector("#grinder2 #exportButton");
      if (grinder1ExportButton) {
        grinder1ExportButton.style.display = "none";
      }
      if (grinder2ExportButton) {
        grinder2ExportButton.style.display = "none";
      }
      localStorage.setItem('lastBackup', currentDate.toISOString());
      console.log('Data shared successfully.');
    })
    .catch((error) => console.log('Error sharing data:', error));
}



// const lastBackupStr = localStorage.getItem('lastBackup');
// const lastBackupDate = new Date(lastBackupStr);
// const currentDate = new Date();

// function shareCSV() {
//   const tbody = document.querySelector('#grinder1 tbody');
//   if (!tbody || !tbody.querySelectorAll('td').length) {
//     return;
//   }
//   const tableRows = tbody.querySelectorAll('tr');
//   const csvRows = Array.from(tableRows)
//     .map(row => Array.from(row.querySelectorAll('td'))
//       .map(cell => cell.textContent.replace(/;/g, '\;'))
//       .join(';')
//     );
//   const csvStr = csvRows.join('\n');
//   const shareData = {
//     title: 'CSV data',
//     text: csvStr,
//     files: [
//       new File([csvStr], 'data.csv', {type: 'text/csv'})
//     ]
//   };
//   navigator.share(shareData)
//     const exportButton = document.querySelector("#exportButton");
//   exportButton.style.display = "none";
//   localStorage.setItem('lastBackup', currentDate.toISOString())
//     .then(() => console.log('Data shared successfully.'))
//     .catch((error) => console.log('Error sharing data:', error));
// }

function showExportButton() {
  const timeDiff = currentDate.getTime() - lastBackupDate.getTime();
  const daysDiff = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
  if (daysDiff < 3) {return}
  const tbody = document.querySelector('tbody');
  if (!tbody || !tbody.querySelectorAll('td').length) {
    return}
  
  const exportButtontemp= document.querySelector("#exportButton");
  exportButtontemp.style.display = "block";
  //sendTableData();
}

// function sendPostRequest(apiKey) {
//   const table1 = document.querySelector('#grinder1 tbody');
//   const rows = Array.from(table1.querySelectorAll('tr'));
//   const csvString = rows.map(row => Array.from(row.cells).map(cell => cell.textContent.trim()).join(',')).join('\n');

//   const script = document.createElement('script');
//   const url = `https://maker.ifttt.com/trigger/CoffeeLog/with/key/${apiKey}?&value1=${encodeURIComponent(csvString)}`;
//   console.log(url);

//   script.src = url;
//   document.body.appendChild(script);
// }


// setTimeout(() => {
// if (localStorage.getItem('iftttKey')){
//  const key = localStorage.getItem('iftttKey')
//  sendPostRequest(key);
// }
// }, 500);

// ================
</script>
</body>
</html>